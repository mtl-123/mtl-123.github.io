(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{381:function(s,a,t){"use strict";t.r(a);var n=t(8),r=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"rsyslog-安装与配置指南-含用户登录信息记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rsyslog-安装与配置指南-含用户登录信息记录"}},[s._v("#")]),s._v(" Rsyslog 安装与配置指南（含用户登录信息记录）")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("目标")]),s._v("：部署 Rsyslog 服务以集中记录所有用户登录信息（包括登录时间、IP、用户身份等）及登录时长分析\n"),a("strong",[s._v("引用来源")]),s._v("：基于 Linux 日志存储结构 "),a("code",[s._v("/var/log")]),s._v(" ，结合日志模板与规则配置")])]),s._v(" "),a("p",[a("img",{attrs:{src:"image.png",alt:"alt text"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"image-1.png",alt:"alt text"}})]),s._v(" "),a("h2",{attrs:{id:"rsyslog-管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rsyslog-管理"}},[s._v("#")]),s._v(" Rsyslog 管理")]),s._v(" "),a("h3",{attrs:{id:"系统日志术语"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统日志术语"}},[s._v("#")]),s._v(" 系统日志术语")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Facility")]),s._v("（设施）：从功能或程序上对日志进行归类")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 内置分类")]),s._v("\nauth, authpriv, cron, daemon, ftp, kern, lpr, mail, news, security"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("auth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", uucp, syslog\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自定义分类")]),s._v("\nlocal0-local7\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[a("strong",[s._v("Priority")]),s._v("（优先级别），从低到高排序：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("debug, info, notice, warn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("warning"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", crit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("critical"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", alert, emerg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("panic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"一、安装-rsyslog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、安装-rsyslog"}},[s._v("#")]),s._v(" 一、安装 Rsyslog")]),s._v(" "),a("h3",{attrs:{id:"_1-安装服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装服务"}},[s._v("#")]),s._v(" 1. 安装服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" rsyslog "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_2-安装扩展模块-可选"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装扩展模块-可选"}},[s._v("#")]),s._v(" 2. 安装扩展模块（可选）")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" rsyslog-gnutls rsyslog-relp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 支持加密传输")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"二、基础配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、基础配置"}},[s._v("#")]),s._v(" 二、基础配置")]),s._v(" "),a("h3",{attrs:{id:"_1-启动服务并设置开机自启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-启动服务并设置开机自启"}},[s._v("#")]),s._v(" 1. 启动服务并设置开机自启")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" rsyslog "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--now")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start rsyslog\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl status rsyslog\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_2-防火墙配置-允许-514-端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-防火墙配置-允许-514-端口"}},[s._v("#")]),s._v(" 2. 防火墙配置（允许 514 端口）")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ufw allow "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("/tcp\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ufw allow "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("/udp\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ufw reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"三、核心配置-记录用户登录信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、核心配置-记录用户登录信息"}},[s._v("#")]),s._v(" 三、核心配置（记录用户登录信息）")]),s._v(" "),a("h3",{attrs:{id:"_1-编辑主配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-编辑主配置文件"}},[s._v("#")]),s._v(" 1. 编辑主配置文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/rsyslog.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2-启用输入模块-udp-tcp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-启用输入模块-udp-tcp"}},[s._v("#")]),s._v(" 2. 启用输入模块（UDP/TCP）")]),s._v(" "),a("p",[s._v("取消注释或添加以下行以启用网络日志接收：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("load"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"imudp"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用 UDP 输入")]),s._v("\ninput"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"imudp"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"514"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("load"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"imtcp"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用 TCP 输入")]),s._v("\ninput"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"imtcp"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"514"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_3-配置日志模板-按日期-主机分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置日志模板-按日期-主机分类"}},[s._v("#")]),s._v(" 3. 配置日志模板（按日期/主机分类）")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("#### GLOBAL DIRECTIVES ####")]),s._v(" 部分添加模板定义：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$template")]),s._v(" RemoteHost,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/log/rsyslog/%'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$YEAR")]),s._v("%/%"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MONTH")]),s._v("%/%"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAY")]),s._v('%/%HOSTNAME%.log"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$template")]),s._v(" DailyAuthLogs,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/log/rsyslog/auth/%'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$YEAR")]),s._v("%/%"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MONTH")]),s._v("%/%"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAY")]),s._v('%/auth.log"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_4-添加日志规则-重点-捕获用户登录行为"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-添加日志规则-重点-捕获用户登录行为"}},[s._v("#")]),s._v(" 4. 添加日志规则（重点：捕获用户登录行为）")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("#### RULES ####")]),s._v(" 部分添加以下规则：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记录所有用户登录/登出事件（SSH、su、sudo）")]),s._v("\nauth,authpriv.* ?DailyAuthLogs\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记录系统中所有日志到主机专属文件")]),s._v("\n*.* ?RemoteHost\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 丢弃重复日志（可选）")]),s._v("\n:msg, contains, "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"session opened"')]),s._v(" ~\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"四、高级配置-登录时长分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、高级配置-登录时长分析"}},[s._v("#")]),s._v(" 四、高级配置（登录时长分析）")]),s._v(" "),a("h3",{attrs:{id:"_1-日志格式定制-增强可读性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-日志格式定制-增强可读性"}},[s._v("#")]),s._v(" 1. 日志格式定制（增强可读性）")]),s._v(" "),a("p",[s._v("在模板中添加字段解析：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$template")]),s._v(" CustomFormat,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%TIMESTAMP:::date-rfc3339% %HOSTNAME% %syslogtag%%msg:::sp-if-no-1st-sp%%msg%"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$template")]),s._v(" DailyPerHostLogs,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/log/rsyslog/%'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$YEAR")]),s._v("%/%"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MONTH")]),s._v("%/%"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAY")]),s._v('%/%HOSTNAME%_%FROMHOST-IP%.log"')]),s._v("\n*.* -?DailyPerHostLogs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_2-启用日志关联-需配合脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-启用日志关联-需配合脚本"}},[s._v("#")]),s._v(" 2. 启用日志关联（需配合脚本）")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("/etc/rsyslog.conf")]),s._v(" 末尾添加：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记录 SSH 登录开始时间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$programname")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sshd'")]),s._v(" and "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$msg")]),s._v(" contains "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'session opened'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v(" /var/log/rsyslog/ssh_sessions.log\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记录 SSH 登出结束时间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$programname")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sshd'")]),s._v(" and "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$msg")]),s._v(" contains "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'session closed'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v(" /var/log/rsyslog/ssh_sessions.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"五、验证与测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、验证与测试"}},[s._v("#")]),s._v(" 五、验证与测试")]),s._v(" "),a("h3",{attrs:{id:"_1-语法检查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-语法检查"}},[s._v("#")]),s._v(" 1. 语法检查")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" rsyslogd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /etc/rsyslog.conf "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-N1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 输出应显示 "End of config validation run"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_2-重启服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-重启服务"}},[s._v("#")]),s._v(" 2. 重启服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart rsyslog\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_3-模拟登录测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-模拟登录测试"}},[s._v("#")]),s._v(" 3. 模拟登录测试")]),s._v(" "),a("p",[s._v("从远程客户端执行 SSH 登录：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" user@your_rsyslog_server_ip\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"主进程检查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主进程检查"}},[s._v("#")]),s._v(" 主进程检查")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("m@m:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" rsyslogd\nsyslog     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45985")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("378628")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5504")]),s._v(" ?        Ssl  07:00   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 /usr/sbin/rsyslogd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-iNONE")]),s._v("\nm          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46559")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6544")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2176")]),s._v(" pts/0    S+   07:33   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--color")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auto rsyslogd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_4-检查日志输出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-检查日志输出"}},[s._v("#")]),s._v(" 4. 检查日志输出")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /var/log/rsyslog/auth/"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%Y/%m/%d"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("/auth.log\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应看到类似以下条目：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2025-05-29T10:20:30+08:00 client_host sshd[1234]: PAM 2 session opened for user admin")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2025-05-29T10:25:45+08:00 client_host sshd[1234]: PAM 2 session closed for user admin")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"六、日志分析-登录时长计算"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、日志分析-登录时长计算"}},[s._v("#")]),s._v(" 六、日志分析（登录时长计算）")]),s._v(" "),a("h3",{attrs:{id:"_1-手动计算-示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-手动计算-示例"}},[s._v("#")]),s._v(" 1. 手动计算（示例）")]),s._v(" "),a("p",[s._v("从日志中提取登录/登出时间并计算差值：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录时间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("login_time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2025-05-29T10:20:30+08:00"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登出时间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("logout_time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2025-05-29T10:25:45+08:00"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 转换为时间戳")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("login_ts")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$login_time")]),s._v('"')]),s._v(" +%s"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("logout_ts")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$logout_time")]),s._v('"')]),s._v(" +%s"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 计算时长（秒）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("duration")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$((")]),s._v("logout_ts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" login_ts"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("))")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"登录时长：'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$((")]),s._v("duration"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("))")])]),s._v(" 分钟 "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$((")]),s._v("duration"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("))")])]),s._v(' 秒"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"_2-自动化脚本-python-示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-自动化脚本-python-示例"}},[s._v("#")]),s._v(" 2. 自动化脚本（Python 示例）")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分析日志并生成报告")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" re\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" datetime "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" datetime\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/log/rsyslog/auth/2025/05/29/auth.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"r"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    logs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("readlines"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nsessions "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" line "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配登录事件")]),s._v("\n    login_match "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" re"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('r"(\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\+\\d{4}) .* sshd.*session opened for user (\\w+)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" line"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" login_match"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        timestamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" login_match"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("groups"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        sessions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"login"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" timestamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配登出事件")]),s._v("\n    logout_match "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" re"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('r"(\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\+\\d{4}) .* sshd.*session closed for user (\\w+)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" line"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" logout_match "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" logout_match"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" sessions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        timestamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logout_match"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("groups"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        sessions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logout"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" timestamp\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 计算并输出时长")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" times "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" sessions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logout"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" times"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        login "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" datetime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fromisoformat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("times"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"login"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        logout "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" datetime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fromisoformat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("times"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logout"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        duration "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("logout "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("total_seconds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string-interpolation"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"用户 ')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(": 登录时长 ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("duration"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(" 分 ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("duration"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(' 秒"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"七、常见问题排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七、常见问题排查"}},[s._v("#")]),s._v(" 七、常见问题排查")]),s._v(" "),a("h3",{attrs:{id:"_1-端口未监听"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-端口未监听"}},[s._v("#")]),s._v(" 1. 端口未监听")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-tulnp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查端口状态")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 若未显示监听，检查 rsyslog.conf 中的 imudp/imtcp 配置")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_2-日志未生成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-日志未生成"}},[s._v("#")]),s._v(" 2. 日志未生成")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("确认客户端发送日志：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("logger "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" your_rsyslog_server_ip "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-P")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("514")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Test Message"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("检查服务日志：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("journalctl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" rsyslog.service "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"附录-关键配置文件路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#附录-关键配置文件路径"}},[s._v("#")]),s._v(" 附录：关键配置文件路径")]),s._v(" "),a("ul",[a("li",[s._v("主配置文件："),a("code",[s._v("/etc/rsyslog.conf")])]),s._v(" "),a("li",[s._v("模块配置目录："),a("code",[s._v("/etc/rsyslog.d/")])]),s._v(" "),a("li",[s._v("日志存储路径："),a("code",[s._v("/var/log/rsyslog/")])])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("提示")]),s._v("：如需图形化分析，可结合 ELK Stack 或 Graylog 实现可视化审计")])]),s._v(" "),a("hr")])}),[],!1,null,null,null);a.default=r.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{377:function(s,t,a){"use strict";a.r(t);var n=a(8),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("详细讲解了如何在 "),t("strong",[s._v("Ubuntu 25.04 (Noble Numbat)")]),s._v(" 上使用 Vagrant + Libvirt/KVM 构建 Redis 集群环境，并包括从安装 KVM、配置桥接网络 "),t("code",[s._v("br0")]),s._v(" 到部署完整集群的全过程。")]),s._v(" "),t("hr"),s._v(" "),t("h1",{attrs:{id:"🚀-使用-vagrant-kvm-搭建-redis-集群-3主3从-环境全攻略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🚀-使用-vagrant-kvm-搭建-redis-集群-3主3从-环境全攻略"}},[s._v("#")]),s._v(" 🚀 使用 Vagrant + KVM 搭建 Redis 集群（3主3从）环境全攻略")]),s._v(" "),t("blockquote",[t("p",[s._v("基于 Ubuntu 25.04 | 支持桥接网络、资源隔离、SSH 优化")])]),s._v(" "),t("h2",{attrs:{id:"📌-背景与目标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#📌-背景与目标"}},[s._v("#")]),s._v(" 📌 背景与目标")]),s._v(" "),t("p",[s._v("在学习和测试分布式系统（如 Redis Cluster）时，我们通常需要一个稳定的多节点虚拟化环境。本文将详细介绍如何在 "),t("strong",[s._v("Ubuntu 25.04")]),s._v(" 系统上：")]),s._v(" "),t("ul",[t("li",[s._v("安装并配置 KVM/QEMU Libvirt")]),s._v(" "),t("li",[s._v("创建桥接网络 "),t("code",[s._v("br0")])]),s._v(" "),t("li",[s._v("使用 Vagrant 自动化部署 6 台 Redis 节点（3 主 3 从）")]),s._v(" "),t("li",[s._v("启用 root 登录、优化 SSH 连接体验")]),s._v(" "),t("li",[s._v("提供可扩展性方案（Ansible、自定义镜像等）")])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"🧰-准备工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🧰-准备工作"}},[s._v("#")]),s._v(" 🧰 准备工作")]),s._v(" "),t("h3",{attrs:{id:"✅-硬件要求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#✅-硬件要求"}},[s._v("#")]),s._v(" ✅ 硬件要求")]),s._v(" "),t("ul",[t("li",[s._v("支持硬件虚拟化的 CPU（Intel VT-x / AMD-V）")]),s._v(" "),t("li",[s._v("至少 16GB 内存（用于运行多个 VM）")]),s._v(" "),t("li",[s._v("至少 50GB 磁盘空间")])]),s._v(" "),t("h3",{attrs:{id:"✅-软件环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#✅-软件环境"}},[s._v("#")]),s._v(" ✅ 软件环境")]),s._v(" "),t("ul",[t("li",[s._v("Ubuntu 25.04 Server 或 Desktop")]),s._v(" "),t("li",[s._v("已连接互联网以下载依赖包")])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"🔧-第一步-安装-kvm-和相关工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🔧-第一步-安装-kvm-和相关工具"}},[s._v("#")]),s._v(" 🔧 第一步：安装 KVM 和相关工具")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" upgrade "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装核心组件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils virt-manager ovmf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加当前用户到 libvirt 组")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aG")]),s._v(" libvirt "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$USER")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aG")]),s._v(" kvm "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$USER")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启生效组权限")]),s._v("\nnewgrp libvirt\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("blockquote",[t("p",[s._v("⚠️ 注意：执行完 "),t("code",[s._v("newgrp libvirt")]),s._v(" 后建议重新登录终端或新开 shell 窗口")])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"🌐-第二步-配置桥接网络-br0"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🌐-第二步-配置桥接网络-br0"}},[s._v("#")]),s._v(" 🌐 第二步：配置桥接网络 br0")]),s._v(" "),t("p",[s._v("Vagrant 默认使用 NAT 模式，但在生产模拟中我们更希望使用桥接模式让虚拟机获得真实 IP。")]),s._v(" "),t("h3",{attrs:{id:"📝-编辑-netplan-配置文件-路径可能不同-请根据实际情况修改"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#📝-编辑-netplan-配置文件-路径可能不同-请根据实际情况修改"}},[s._v("#")]),s._v(" 📝 编辑 Netplan 配置文件（路径可能不同，请根据实际情况修改）")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/netplan/*.yaml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("替换为如下内容（请根据你的物理网卡名称调整 "),t("code",[s._v("enpXsY")]),s._v("）：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ethernets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enp1s0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dhcp4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" no\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bridges")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("br0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("interfaces")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("enp1s0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dhcp4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" yes\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parameters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stp")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("forward-delay")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h3",{attrs:{id:"🔄-应用配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🔄-应用配置"}},[s._v("#")]),s._v(" 🔄 应用配置")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" netplan apply\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"📌-查看桥接接口状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#📌-查看桥接接口状态"}},[s._v("#")]),s._v(" 📌 查看桥接接口状态")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" a show br0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("hr"),s._v(" "),t("h2",{attrs:{id:"📦-第三步-安装-vagrant-并添加-libvirt-插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#📦-第三步-安装-vagrant-并添加-libvirt-插件"}},[s._v("#")]),s._v(" 📦 第三步：安装 Vagrant 并添加 Libvirt 插件")]),s._v(" "),t("h3",{attrs:{id:"📥-安装-vagrant"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#📥-安装-vagrant"}},[s._v("#")]),s._v(" 📥 安装 Vagrant")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://releases.hashicorp.com/vagrant/2.4.2/vagrant_2.4.2_linux_amd64.zip\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" vagrant_2.4.2_linux_amd64.zip\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" vagrant /usr/local/bin/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("验证是否成功：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("vagrant "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"🧩-安装-libvirt-插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🧩-安装-libvirt-插件"}},[s._v("#")]),s._v(" 🧩 安装 Libvirt 插件")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("vagrant plugin "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" vagrant-libvirt\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("hr"),s._v(" "),t("h2",{attrs:{id:"📄-第四步-编写-vagrantfile-部署-redis-集群节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#📄-第四步-编写-vagrantfile-部署-redis-集群节点"}},[s._v("#")]),s._v(" 📄 第四步：编写 Vagrantfile 部署 Redis 集群节点")]),s._v(" "),t("p",[s._v("创建一个项目目录：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" redis-cluster "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" redis-cluster\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" Vagrantfile\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("粘贴如下完整 Vagrantfile：")]),s._v(" "),t("div",{staticClass:"language-ruby line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -*- mode: ruby -*-")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi: set ft=ruby :")]),s._v("\n\nVagrant"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("configure"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n\n  config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("box "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bento/ubuntu-24.04"')])]),s._v("\n  config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("box_version "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"202502.21.0"')])]),s._v("\n  config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("synced_folder "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"."')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/vagrant"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("disabled")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n  config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("provider "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":libvirt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("libvirt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n    libvirt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("driver "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kvm"')])]),s._v("\n    libvirt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connect_via_ssh "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    libvirt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("storage_pool_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n  nodes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":redis_master1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("ip")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.100.10"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis-master1"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("memory")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("cpus")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":redis_master2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("ip")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.100.11"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis-master2"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("memory")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("cpus")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":redis_master3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("ip")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.100.12"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis-master3"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("memory")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("cpus")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":redis_slave1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("ip")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.100.13"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis-slave1"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("memory")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("cpus")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":redis_slave2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("ip")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.100.14"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis-slave2"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("memory")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("cpus")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":redis_slave3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("ip")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.100.15"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis-slave3"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("memory")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("cpus")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n  nodes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("each")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("node"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n    config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("define node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("machine"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n      machine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":hostname")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n      machine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("network "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":public_network")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"br0"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("mode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge"')])]),s._v("\n\n      machine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("provider "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":libvirt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("domain"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n        domain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("memory "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fetch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":memory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        domain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cpus "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fetch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":cpus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        domain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("disk_bus "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"virtio"')])]),s._v("\n        domain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("disk_driver cache"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'none'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("io")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'native'")])]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n      machine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("provision "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"install-common-tools"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shell"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("inline")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal heredoc-string"}},[t("span",{pre:!0,attrs:{class:"token delimiter"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<<-")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("SHELL")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\n        echo "🔄 正在更新 apt 缓存..."\n        apt update -y\n\n        echo "📦 安装常用工具：git lrzsz wget curl vim net-tools..."\n        apt install -y git lrzsz wget curl vim net-tools software-properties-common\n\n        echo "✅ 常用工具安装完成"\n      ')]),t("span",{pre:!0,attrs:{class:"token delimiter"}},[t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("SHELL")])])]),s._v("\n\n      machine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("provision "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enable-root-ssh"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shell"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("inline")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal heredoc-string"}},[t("span",{pre:!0,attrs:{class:"token delimiter"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<<-")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("SHELL")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\n        echo "🔐 设置 root 密码并启用 SSH 登录..."\n\n        echo "root:vagrant" | chpasswd\n\n        if ! grep -q "PermitRootLogin yes" /etc/ssh/sshd_config; then\n          sed -i \'s/PermitRootLogin prohibit-password/PermitRootLogin yes/\' /etc/ssh/sshd_config\n        fi\n\n        if ! grep -q "PasswordAuthentication yes" /etc/ssh/sshd_config; then\n          sed -i \'s/PasswordAuthentication no/PasswordAuthentication yes/\' /etc/ssh/sshd_config\n        fi\n\n        mkdir -p /root/.ssh\n        cp /home/vagrant/.ssh/authorized_keys /root/.ssh/\n        chown -R root:root /root/.ssh\n        chmod 700 /root/.ssh\n        chmod 600 /root/.ssh/authorized_keys\n\n        systemctl restart ssh\n\n        echo "✅ root 登录已启用"\n      ')]),t("span",{pre:!0,attrs:{class:"token delimiter"}},[t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("SHELL")])])]),s._v("\n\n      machine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("provision "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"optimize-ssh"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shell"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("inline")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string-literal heredoc-string"}},[t("span",{pre:!0,attrs:{class:"token delimiter"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<<-")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("SHELL")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\n        echo "🔧 优化 SSH 配置..."\n\n        if ! grep -q "UseDNS no" /etc/ssh/sshd_config; then\n          echo "UseDNS no" >> /etc/ssh/sshd_config\n        fi\n\n        if ! grep -q "GSSAPIAuthentication no" /etc/ssh/sshd_config; then\n          echo "GSSAPIAuthentication no" >> /etc/ssh/sshd_config\n        fi\n\n        if ! grep -q "ClientAliveInterval 300" /etc/ssh/sshd_config; then\n          echo "ClientAliveInterval 300" >> /etc/ssh/sshd_config\n        fi\n\n        if ! grep -q "ClientAliveCountMax 3" /etc/ssh/sshd_config; then\n          echo "ClientAliveCountMax 3" >> /etc/ssh/sshd_config\n        fi\n\n        systemctl restart ssh\n\n        echo "✅ SSH 已优化：禁用 DNS + 启用保活"\n      ')]),t("span",{pre:!0,attrs:{class:"token delimiter"}},[t("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("SHELL")])])]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br")])]),t("hr"),s._v(" "),t("h2",{attrs:{id:"▶️-第五步-启动集群环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#▶️-第五步-启动集群环境"}},[s._v("#")]),s._v(" ▶️ 第五步：启动集群环境")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("vagrant up "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--provider")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("libvirt\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("⏱️ 第一次运行会自动下载 box 镜像，可能需要几分钟时间。")])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"📋-第六步-访问和管理虚拟机"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#📋-第六步-访问和管理虚拟机"}},[s._v("#")]),s._v(" 📋 第六步：访问和管理虚拟机")]),s._v(" "),t("h3",{attrs:{id:"🔍-查看所有节点状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🔍-查看所有节点状态"}},[s._v("#")]),s._v(" 🔍 查看所有节点状态")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("vagrant status\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"💻-ssh-登录某台机器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#💻-ssh-登录某台机器"}},[s._v("#")]),s._v(" 💻 SSH 登录某台机器")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("vagrant "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" redis_master1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"🧑‍💻-使用-root-登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#🧑‍💻-使用-root-登录"}},[s._v("#")]),s._v(" 🧑‍💻 使用 root 登录")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@192.168.100.10\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 密码：vagrant")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("hr"),s._v(" "),t("h2",{attrs:{id:"📈-可选增强功能-进阶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#📈-可选增强功能-进阶"}},[s._v("#")]),s._v(" 📈 可选增强功能（进阶）")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("功能")]),s._v(" "),t("th",[s._v("实现方式")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("自动生成 Ansible Playbook")]),s._v(" "),t("td",[s._v("自动化部署 Redis 集群")])]),s._v(" "),t("tr",[t("td",[s._v("构建自定义 box 镜像（预装工具+SSH优化）")]),s._v(" "),t("td",[s._v("使用 Packer")])]),s._v(" "),t("tr",[t("td",[s._v("封装一键启动脚本")]),s._v(" "),t("td",[s._v("写一个 "),t("code",[s._v("start.sh")]),s._v(" 启动脚本")])]),s._v(" "),t("tr",[t("td",[s._v("添加 Redis 一键部署脚本")]),s._v(" "),t("td",[s._v("包括主从、集群模式初始化")])]),s._v(" "),t("tr",[t("td",[s._v("支持 Kubernetes 部署")]),s._v(" "),t("td",[s._v("加入 kubeadm 初始化脚本")])])])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"✅-总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#✅-总结"}},[s._v("#")]),s._v(" ✅ 总结")]),s._v(" "),t("p",[s._v("通过本教程，你已经掌握了：")]),s._v(" "),t("ul",[t("li",[s._v("如何在 Ubuntu 25.04 上搭建基于 KVM 的虚拟化平台")]),s._v(" "),t("li",[s._v("如何配置桥接网络 "),t("code",[s._v("br0")])]),s._v(" "),t("li",[s._v("如何使用 Vagrant 自动化部署 Redis 集群节点")]),s._v(" "),t("li",[s._v("如何优化 SSH 登录体验和安全性")])]),s._v(" "),t("p",[s._v("这套环境非常适合用于 Redis Cluster 学习、测试以及 CI/CD 场景中的自动化部署。")]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"📬-如果你需要我为你定制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#📬-如果你需要我为你定制"}},[s._v("#")]),s._v(" 📬 如果你需要我为你定制：")]),s._v(" "),t("ul",[t("li",[s._v("整套 Ansible 自动部署 Redis 集群脚本")]),s._v(" "),t("li",[s._v("使用 Packer 构建预装环境的 Vagrant Box")]),s._v(" "),t("li",[s._v("图形界面版本（带 Virt-Manager 支持）")]),s._v(" "),t("li",[s._v("集成 Prometheus/Grafana 监控")]),s._v(" "),t("li",[s._v("支持 Kubernetes 环境集成")])]),s._v(" "),t("hr")])}),[],!1,null,null,null);t.default=r.exports}}]);
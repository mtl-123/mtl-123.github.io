(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{383:function(s,a,t){"use strict";t.r(a);var e=t(8),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"linux-auditd-配置手册-监控用户登录时间与统计未登录用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux-auditd-配置手册-监控用户登录时间与统计未登录用户"}},[s._v("#")]),s._v(" Linux Auditd 配置手册：监控用户登录时间与统计未登录用户")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"一、安装-auditd-服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、安装-auditd-服务"}},[s._v("#")]),s._v(" "),a("strong",[s._v("一、安装 Auditd 服务")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" auditd audispd-plugins "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"二、配置-auditd-主文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、配置-auditd-主文件"}},[s._v("#")]),s._v(" "),a("strong",[s._v("二、配置 Auditd 主文件")])]),s._v(" "),a("p",[s._v("编辑 "),a("code",[s._v("/etc/audit/auditd.conf")]),s._v("，调整以下核心参数：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志文件路径（默认已存在）")]),s._v("\nlog_file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/log/audit/audit.log\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志格式（推荐 ENRICHED 以包含更多上下文）")]),s._v("\nlog_format "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ENRICHED\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志轮转策略")]),s._v("\nmax_log_file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 单个日志文件最大大小（MB）")]),s._v("\nmax_log_file_action "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ROTATE  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 超出大小后轮转")]),s._v("\nnum_logs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保留历史日志文件数量")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘空间告警（触发时暂停写入）")]),s._v("\nadmin_space_left_action "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SUSPEND\ndisk_full_action "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SUSPEND\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志队列深度（防止日志丢失）")]),s._v("\nq_depth "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\noverflow_action "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SYSLOG\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("生效配置")]),s._v("：修改后重启服务 "),a("code",[s._v("sudo systemctl restart auditd")])])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"三、添加审计规则-监控登录事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、添加审计规则-监控登录事件"}},[s._v("#")]),s._v(" "),a("strong",[s._v("三、添加审计规则（监控登录事件）")])]),s._v(" "),a("h3",{attrs:{id:"_1-监控用户登录-登出事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-监控用户登录-登出事件"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1. 监控用户登录/登出事件")])]),s._v(" "),a("p",[s._v("无需额外规则，Auditd 默认已记录以下事件：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("登录成功")]),s._v("："),a("code",[s._v("USER_LOGIN")]),s._v(" 类型")]),s._v(" "),a("li",[a("strong",[s._v("登出")]),s._v("："),a("code",[s._v("USER_LOGOUT")]),s._v(" 类型")]),s._v(" "),a("li",[a("strong",[s._v("SSH 登录尝试")]),s._v("："),a("code",[s._v("sshd")]),s._v(" 相关事件")])]),s._v(" "),a("h3",{attrs:{id:"_2-自定义规则-可选"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-自定义规则-可选"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2. 自定义规则（可选）")])]),s._v(" "),a("p",[s._v("若需更精细控制，添加规则到 "),a("code",[s._v("/etc/audit/rules.d/audit.rules")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监控 PAM 模块认证事件（涵盖登录）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" /var/log/auth.log "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" wa "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" auth_events\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监控 SSH 登录会话（记录 session opened/closed）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" always,exit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-F")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("arch")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("b64 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" execve "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" uid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v("euid "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-F")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("euid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" ssh_login\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("生效规则")]),s._v("：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" augenrules "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--load")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加载新规则")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" auditctl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证规则列表")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"四、查询用户登录记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、查询用户登录记录"}},[s._v("#")]),s._v(" "),a("strong",[s._v("四、查询用户登录记录")])]),s._v(" "),a("h3",{attrs:{id:"_1-使用-ausearch-查询指定时间范围"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用-ausearch-查询指定时间范围"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1. 使用 "),a("code",[s._v("ausearch")]),s._v(" 查询指定时间范围")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询今日所有登录事件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ausearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--start")]),s._v(" today "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" login\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询特定用户（如 user1）的登录记录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ausearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ua")]),s._v(" user1\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询 SSH 登录事件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ausearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" ssh_login\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"_2-使用-aureport-生成摘要报告"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用-aureport-生成摘要报告"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2. 使用 "),a("code",[s._v("aureport")]),s._v(" 生成摘要报告")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成登录事件日报")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" aureport "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--login")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--summary")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成指定日期的登录报告（如 2025-05-01）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" aureport "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--start")]),s._v(" 05/01/2025 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--end")]),s._v(" 05/02/2025 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--login")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"五、统计长期未登录用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、统计长期未登录用户"}},[s._v("#")]),s._v(" "),a("strong",[s._v("五、统计长期未登录用户")])]),s._v(" "),a("p",[s._v("Auditd 本身不直接提供“未登录用户”统计，需结合系统命令实现：")]),s._v(" "),a("h3",{attrs:{id:"_1-使用-lastlog-命令-推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用-lastlog-命令-推荐"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1. 使用 "),a("code",[s._v("lastlog")]),s._v(" 命令（推荐）")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有用户最近登录时间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" lastlog\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 过滤超过 90 天未登录的用户（示例）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" lastlog "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'$5 == "**Never logged in**" || $NF+0 < $(date +%s -d "90 days ago") {print $1}\'')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_2-结合-audit-日志分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-结合-audit-日志分析"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2. 结合 Audit 日志分析")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 提取所有用户的最新登录时间戳")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ausearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--raw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--login")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'auid='")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $3}'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /tmp/active_users.txt\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对比系统用户列表")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("comm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-23")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cut")]),s._v(" -d: "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f1")]),s._v(" /etc/passwd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" /tmp/active_users.txt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"六、日志轮转与清理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、日志轮转与清理"}},[s._v("#")]),s._v(" "),a("strong",[s._v("六、日志轮转与清理")])]),s._v(" "),a("p",[s._v("配置 "),a("code",[s._v("/etc/logrotate.d/auditd")]),s._v(" 优化日志管理：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("/var/log/audit/audit.log "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    weekly\n    missingok\n    rotate "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n    compress\n    delaycompress\n    notifempty\n    create 0640 root adm\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"七、验证配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七、验证配置"}},[s._v("#")]),s._v(" "),a("strong",[s._v("七、验证配置")])]),s._v(" "),a("ol",[a("li",[a("p",[a("strong",[s._v("模拟登录事件")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" testuser@localhost  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 产生登录日志")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("检查日志输出")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ausearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" login "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user='")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"八、常见问题排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#八、常见问题排查"}},[s._v("#")]),s._v(" "),a("strong",[s._v("八、常见问题排查")])]),s._v(" "),a("ol",[a("li",[a("p",[a("strong",[s._v("服务未运行")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl status auditd\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" journalctl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" auditd    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看服务启动日志")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("权限不足")]),s._v("：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("确保用户属于 "),a("code",[s._v("adm")]),s._v(" 组（可读日志）：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-aG")]),s._v(" adm your_user\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("规则未生效")]),s._v("：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("检查规则加载状态：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" auditctl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" login\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])])])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"九、附录-关键日志字段说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#九、附录-关键日志字段说明"}},[s._v("#")]),s._v(" "),a("strong",[s._v("九、附录：关键日志字段说明")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("字段名")]),s._v(" "),a("th",[s._v("含义")]),s._v(" "),a("th",[s._v("示例值")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[a("code",[s._v("auid")])]),s._v(" "),a("td",[s._v("审计用户ID（登录时分配）")]),s._v(" "),a("td",[a("code",[s._v("auid=1000")])])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("uid")])]),s._v(" "),a("td",[s._v("当前进程用户ID")]),s._v(" "),a("td",[a("code",[s._v("uid=0")]),s._v("（root）")])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("ses")])]),s._v(" "),a("td",[s._v("会话ID")]),s._v(" "),a("td",[a("code",[s._v("ses=1234")])])]),s._v(" "),a("tr",[a("td",[a("code",[s._v("msg=audit()")])]),s._v(" "),a("td",[s._v("时间戳（Unix 时间）")]),s._v(" "),a("td",[a("code",[s._v("audit(1620000000.123)")])])])])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("通过以上配置，您可实现：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("实时监控用户登录时间与持续时间")])]),s._v(" "),a("li",[a("strong",[s._v("统计长期未登录用户")])]),s._v(" "),a("li",[a("strong",[s._v("审计日志的安全存储与轮转")])])]),s._v(" "),a("p",[s._v("如需进一步集成 SIEM 系统（如 ELK、Splunk），可配置 Auditd 将日志转发至远程服务器 。")])])}),[],!1,null,null,null);a.default=r.exports}}]);
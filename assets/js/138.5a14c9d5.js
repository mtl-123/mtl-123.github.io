(window.webpackJsonp=window.webpackJsonp||[]).push([[138],{499:function(s,a,t){"use strict";t.r(a);var n=t(8),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("hr"),s._v(" "),a("h1",{attrs:{id:"samba-权限配置方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#samba-权限配置方案"}},[s._v("#")]),s._v(" Samba 权限配置方案")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"一、环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、环境准备"}},[s._v("#")]),s._v(" 一、环境准备")]),s._v(" "),a("h3",{attrs:{id:"_1-安装必要组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装必要组件"}},[s._v("#")]),s._v(" 1. 安装必要组件")]),s._v(" "),a("code-group",[a("code-block",{attrs:{title:"apt",active:""}},[a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装Samba和ACL工具")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" samba acl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])],1),s._v(" "),a("p",[a("strong",[s._v("验证安装")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("dpkg "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" samba  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确认samba已安装")]),s._v("\ndpkg "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" acl    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确认acl已安装")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"二、目录结构与基础权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、目录结构与基础权限"}},[s._v("#")]),s._v(" 二、目录结构与基础权限")]),s._v(" "),a("h3",{attrs:{id:"_2-创建共享目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建共享目录"}},[s._v("#")]),s._v(" 2. 创建共享目录")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /home/samba/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("finance,it,readonly,restricted"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" root:sambashare /home/samba  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置所有者为root和sambashare组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2775")]),s._v(" /home/samba  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置SGID位，确保新文件继承组权限")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("验证目录权限")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ld")]),s._v(" /home/samba  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应显示 drwxrwsr-x")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ld")]),s._v(" /home/samba/*  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 子目录权限应一致")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"三、用户与组管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、用户与组管理"}},[s._v("#")]),s._v(" 三、用户与组管理")]),s._v(" "),a("h3",{attrs:{id:"_3-创建用户组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建用户组"}},[s._v("#")]),s._v(" 3. 创建用户组")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" finance\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" itstaff\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" restrictedgroup\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("验证组是否存在")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/group "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" finance  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应显示finance组")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_4-创建用户并加入组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建用户并加入组"}},[s._v("#")]),s._v(" 4. 创建用户并加入组")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-G")]),s._v(" finance alice\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-G")]),s._v(" itstaff bob\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-G")]),s._v(" restrictedgroup charlie\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" diana\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("验证用户组归属")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groups")]),s._v(" alice  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应包含finance组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groups")]),s._v(" bob    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应包含itstaff组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groups")]),s._v(" charlie  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应包含restrictedgroup组")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_5-设置samba密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-设置samba密码"}},[s._v("#")]),s._v(" 5. 设置Samba密码")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" smbpasswd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" alice\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" smbpasswd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" bob\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" smbpasswd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" charlie\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" smbpasswd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" diana\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("验证Samba用户")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("pdbedit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" alice  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应显示alice的Samba账号")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"四、核心配置文件-etc-samba-smb-conf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、核心配置文件-etc-samba-smb-conf"}},[s._v("#")]),s._v(" 四、核心配置文件（"),a("code",[s._v("/etc/samba/smb.conf")]),s._v("）")]),s._v(" "),a("h3",{attrs:{id:"_6-配置文件优化-注释规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-配置文件优化-注释规范"}},[s._v("#")]),s._v(" 6. 配置文件优化（注释规范）")]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全局安全配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 强制使用SMB3协议（禁用不安全的SMB1）")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server min protocol")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("SMB3")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 强制用户认证")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("security")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("user")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 日志配置")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("log file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/log/samba/log.%m")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("max log size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1000")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 启用加密签名")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server signing")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("mandatory")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("client signing")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("mandatory")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 财务部共享（组权限+网段限制）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("Finance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 共享路径")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("path")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/home/samba/finance")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 仅finance组成员可访问")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("valid users")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("@finance")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 允许192.168.1.0/24网段访问")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("hosts allow")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("192.168.1.0/24")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 可读写")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("read only")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("no")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 文件权限掩码（0640）")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("create mask")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("0640")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 目录权限掩码（0750）")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("directory mask")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("0750")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. IT共享（组权限+强制权限）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("ITShare")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 共享路径")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("path")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/home/samba/it")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 仅itstaff组成员可访问")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("valid users")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("@itstaff")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 可读写")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("read only")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("no")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 强制文件权限为0644")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("force create mode")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("0644")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 强制目录权限为0755")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("force directory mode")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("0755")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 排除垃圾文件")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("veto files")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/.DS_Store/Thumbs.db")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 公共只读共享（匿名访问）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("ReadOnly")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 共享路径")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("path")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/home/samba/readonly")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 允许匿名访问")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("guest ok")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("yes")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 仅读")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("read only")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("yes")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 匿名用户使用nobody账号")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("guest account")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("nobody")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. 限制性共享（用户级权限）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("Restricted")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 共享路径")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("path")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/home/samba/restricted")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 仅charlie和diana可访问")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("valid users")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("charlie,diana")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 仅charlie可写")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("write list")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("charlie")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 默认只读")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("read only")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("yes")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br")])]),a("p",[a("strong",[s._v("验证配置文件语法")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" testparm  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 无报错即成功")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"五、高级权限控制-acl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、高级权限控制-acl"}},[s._v("#")]),s._v(" 五、高级权限控制（ACL）")]),s._v(" "),a("h3",{attrs:{id:"_7-设置文件级acl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-设置文件级acl"}},[s._v("#")]),s._v(" 7. 设置文件级ACL")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应用默认ACL（递归）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" setfacl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" u:charlie:rwx /home/samba/restricted\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" setfacl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" u:diana:r-x /home/samba/restricted\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("验证ACL权限")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("getfacl /home/samba/restricted  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应显示charlie:rwx和diana:r-x")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"六、服务管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、服务管理"}},[s._v("#")]),s._v(" 六、服务管理")]),s._v(" "),a("h3",{attrs:{id:"_8-重启并启用服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-重启并启用服务"}},[s._v("#")]),s._v(" 8. 重启并启用服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart smbd nmbd\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" smbd nmbd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("验证服务状态")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl status smbd  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应显示active (running)")]),s._v("\nsystemctl status nmbd  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应显示active (running)")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"七、网络与安全加固"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七、网络与安全加固"}},[s._v("#")]),s._v(" 七、网络与安全加固")]),s._v(" "),a("h3",{attrs:{id:"_9-防火墙配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-防火墙配置"}},[s._v("#")]),s._v(" 9. 防火墙配置")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许Samba端口（445、139等）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ufw allow "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Samba'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁用SMB1端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ufw delete allow "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("139")]),s._v("/tcp\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("验证防火墙规则")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ufw status "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" Samba  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应显示允许的规则")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"八、权限验证示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#八、权限验证示例"}},[s._v("#")]),s._v(" 八、权限验证示例")]),s._v(" "),a("h3",{attrs:{id:"_10-财务共享验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-财务共享验证"}},[s._v("#")]),s._v(" 10. 财务共享验证")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从192.168.1.0/24网段登录")]),s._v("\nsmbclient //server-ip/Finance "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-U")]),s._v(" alice\nsmb: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" put test.txt  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应成功上传")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 非授权用户测试")]),s._v("\nsmbclient //server-ip/Finance "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-U")]),s._v(" diana  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应被拒绝")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_11-限制性共享验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-限制性共享验证"}},[s._v("#")]),s._v(" 11. 限制性共享验证")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户charlie可写")]),s._v("\nsmbclient //server-ip/Restricted "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-U")]),s._v(" charlie\nsmb: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" put secret.txt  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许写入")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户diana仅可读")]),s._v("\nsmbclient //server-ip/Restricted "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-U")]),s._v(" diana\nsmb: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" put test.txt  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拒绝写入")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"_12-公共只读共享验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-公共只读共享验证"}},[s._v("#")]),s._v(" 12. 公共只读共享验证")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匿名访问")]),s._v("\nsmbclient //server-ip/ReadOnly "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-N")]),s._v("\nsmb: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" get public.txt  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许下载")]),s._v("\nsmb: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" put new.txt     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拒绝上传")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"九、关键步骤补充"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#九、关键步骤补充"}},[s._v("#")]),s._v(" 九、关键步骤补充")]),s._v(" "),a("h3",{attrs:{id:"_13-文件系统acl支持检查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-文件系统acl支持检查"}},[s._v("#")]),s._v(" 13. 文件系统ACL支持检查")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" /home/samba  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确认挂载参数包含acl")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 若未包含，修改/etc/fstab：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("your-disk-uuid /home/samba ext4 defaults,acl "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新挂载：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" remount,acl /home/samba\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_14-selinux-apparmor配置-如适用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-selinux-apparmor配置-如适用"}},[s._v("#")]),s._v(" 14. SELinux/AppArmor配置（如适用）")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查SELinux状态")]),s._v("\nsestatus\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时禁用SELinux（仅测试环境）：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" setenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久禁用（修改/etc/selinux/config）：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SELINUX")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("disabled\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# AppArmor配置（如需允许Samba访问）：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" aa-disable /etc/apparmor.d/usr.sbin.smbd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"_15-配置日志轮转"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_15-配置日志轮转"}},[s._v("#")]),s._v(" 15. 配置日志轮转")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /etc/logrotate.d/samba /etc/logrotate.d/samba.bak\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑日志轮转配置：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" /etc/logrotate.d/samba\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加或修改：")]),s._v("\n/var/log/samba/log.%m "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rotate "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\n    daily\n    missingok\n    notifempty\n    compress\n    delaycompress\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"十、常见问题排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#十、常见问题排查"}},[s._v("#")]),s._v(" 十、常见问题排查")]),s._v(" "),a("h3",{attrs:{id:"_16-配置文件报错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16-配置文件报错"}},[s._v("#")]),s._v(" 16. 配置文件报错")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("错误示例")]),s._v("："),a("code",[s._v("invalid characters were found")])]),s._v(" "),a("li",[a("strong",[s._v("解决")]),s._v("：检查注释是否与配置项在同一行，确保注释单独成行。")])]),s._v(" "),a("h3",{attrs:{id:"_17-权限问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_17-权限问题"}},[s._v("#")]),s._v(" 17. 权限问题")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("错误示例")]),s._v("：用户无法写入文件")]),s._v(" "),a("li",[a("strong",[s._v("解决")]),s._v("：检查"),a("code",[s._v("create mask")]),s._v("和"),a("code",[s._v("directory mask")]),s._v("是否正确，以及ACL设置。")])]),s._v(" "),a("h3",{attrs:{id:"_18-网络连接问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_18-网络连接问题"}},[s._v("#")]),s._v(" 18. 网络连接问题")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("错误示例")]),s._v("：无法访问共享")]),s._v(" "),a("li",[a("strong",[s._v("解决")]),s._v("：检查防火墙规则和Samba服务状态。")])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"十一、附录-权限对照表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#十一、附录-权限对照表"}},[s._v("#")]),s._v(" 十一、附录：权限对照表")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("共享名称")]),s._v(" "),a("th",[s._v("访问用户/组")]),s._v(" "),a("th",[s._v("写入权限用户")]),s._v(" "),a("th",[s._v("网段限制")]),s._v(" "),a("th",[s._v("ACL增强")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("Finance")]),s._v(" "),a("td",[s._v("@finance组")]),s._v(" "),a("td",[s._v("组成员")]),s._v(" "),a("td",[s._v("192.168.1.0/24")]),s._v(" "),a("td",[s._v("是")])]),s._v(" "),a("tr",[a("td",[s._v("ITShare")]),s._v(" "),a("td",[s._v("@itstaff组")]),s._v(" "),a("td",[s._v("组成员")]),s._v(" "),a("td",[s._v("无")]),s._v(" "),a("td",[s._v("否")])]),s._v(" "),a("tr",[a("td",[s._v("ReadOnly")]),s._v(" "),a("td",[s._v("所有用户")]),s._v(" "),a("td",[s._v("无")]),s._v(" "),a("td",[s._v("无")]),s._v(" "),a("td",[s._v("否")])]),s._v(" "),a("tr",[a("td",[s._v("Restricted")]),s._v(" "),a("td",[s._v("charlie,diana")]),s._v(" "),a("td",[s._v("仅charlie")]),s._v(" "),a("td",[s._v("无")]),s._v(" "),a("td",[s._v("是")])])])]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"部署提示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署提示"}},[s._v("#")]),s._v(" 部署提示")]),s._v(" "),a("ol",[a("li",[s._v("替换"),a("code",[s._v("server-ip")]),s._v("为实际服务器IP。")]),s._v(" "),a("li",[s._v("通过"),a("code",[s._v("net usershare")]),s._v("管理简易共享。")]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("acl")]),s._v("包实现更细粒度权限控制。")]),s._v(" "),a("li",[s._v("定期执行"),a("code",[s._v("sudo smbstatus")]),s._v("监控连接状态。")])])],1)}),[],!1,null,null,null);a.default=e.exports}}]);
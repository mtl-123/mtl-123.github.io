---
title: zsh
date: 2025-05-07 14:25:31
permalink: /pages/640852/
categories:
  - 《zsh编辑器》
tags:
  - vim
author:
  name: MeiChen
  link: https://github.com/mtl-123
---

```bsh
# ==============================================================================
# 基础全局配置
# ==============================================================================
ENABLE_CORRECTION="true"
COMPLETION_WAITING_DOTS="true"

# 自定义 Oh My Zsh 路径（不存在时自动创建）
export ZSH="/opt/develop/Tools/.oh-my-zsh"
export ZSH_AUTOSUGGEST_STRATEGY=(history completion)
ZSH_THEME="jonathan"

# 历史记录优化
HISTSIZE=5000
SAVEHIST=$HISTSIZE
HISTDUP=erase
setopt appendhistory
setopt sharehistory
setopt hist_ignore_space
setopt hist_save_no_dups
setopt hist_ignore_dups
setopt hist_find_no_dups

# 快捷键：emacs 模式
bindkey -e

# ==============================================================================
# 代理配置（适配 clash/p 等，端口 10808）
# ==============================================================================
# 清理旧代理残留
git config --global --unset http.proxy 2>/dev/null
git config --global --unset https.proxy 2>/dev/null
git config --global --unset http.https://github.com.proxy 2>/dev/null
git config --global --unset https.https://github.com.proxy 2>/dev/null
unset http_proxy https_proxy all_proxy

PROXY_PORT="10808"
PROXY_ADDR="socks5://127.0.0.1:${PROXY_PORT}"

# 全局终端代理
export http_proxy="${PROXY_ADDR}"
export https_proxy="${PROXY_ADDR}"
export all_proxy="${PROXY_ADDR}"
export no_proxy="localhost,127.0.0.1,::1,*.cn,*.aliyun.com,*.taobao.com,*.tencent.com,*.baidu.com"

# Git 专属代理（仅 github.com）
git config --global http.https://github.com.proxy "${PROXY_ADDR}" 2>/dev/null
git config --global https.https://github.com.proxy "${PROXY_ADDR}" 2>/dev/null

# ==============================================================================
# Zinit 初始化（高性能插件管理器）
# ==============================================================================
export ZINIT_HOME="${XDG_DATA_HOME:-${HOME}/.local/share}/zinit/zinit.git"

# 修复损坏的 Zinit 目录
if [[ -d "$ZINIT_HOME" && ! -f "${ZINIT_HOME}/zinit.zsh" ]]; then
    rm -rf "$ZINIT_HOME"
fi

# 自动安装 Zinit（双源保障）
if [[ ! -d "$ZINIT_HOME" ]]; then
    mkdir -p "$(dirname "$ZINIT_HOME")"
    if ! git clone https://github.com/zdharma-continuum/zinit.git "$ZINIT_HOME" 2>/dev/null; then
        git clone https://ghproxy.com/https://github.com/zdharma-continuum/zinit.git "$ZINIT_HOME"
    fi
fi

source "${ZINIT_HOME}/zinit.zsh"
autoload -Uz _zinit
(( ${+_comps} )) && _comps[zinit]=_zinit

# ==============================================================================
# Zinit 插件配置（按加载顺序优化）
# ==============================================================================
# Oh My Zsh 插件（通过 snippet 复用，避免完整加载 OMZ 框架）
zinit ice wait"0" lucid
zinit snippet OMZ::plugins/git/git.plugin.zsh

zinit ice wait"0" lucid
zinit snippet OMZ::plugins/git-extras/git-extras.plugin.zsh

zinit ice wait"0" lucid
zinit snippet OMZ::plugins/z/z.plugin.zsh

zinit ice wait"0" lucid
zinit snippet OMZ::plugins/autojump/autojump.plugin.zsh

zinit ice wait"0" lucid
zinit snippet OMZ::plugins/web-search/web-search.plugin.zsh

zinit ice wait"0" lucid blockf
zinit snippet OMZ::plugins/docker/docker.plugin.zsh

zinit ice wait"0" lucid blockf
zinit snippet OMZ::plugins/docker-compose/docker-compose.plugin.zsh

# 独立高性能插件
zinit ice wait"0" lucid
zinit light zsh-users/zsh-autosuggestions

zinit ice wait"0" lucid blockf
zinit light zsh-users/zsh-completions

# 语法高亮（必须在 autocomplete 前加载）
zinit ice wait"0" lucid atinit"ZINIT[COMPINIT_OPTS]=-C; zicompinit; zicdreplay"
zinit light zdharma-continuum/fast-syntax-highlighting

# 智能实时补全（最后加载）
zinit ice wait"1" lucid atinit"ZINIT[COMPINIT_OPTS]=-C; zicompinit; zicdreplay"
zinit light marlonrichert/zsh-autocomplete

# ==============================================================================
# 补全系统隔离（禁止 OMZ 二次初始化）
# ==============================================================================
export SKIP_GLOBAL_COMPINIT=1

# ==============================================================================
# 环境变量配置
# ==============================================================================
# 基础 PATH（优先级：用户本地 > cargo > 系统）
export PATH="$HOME/.local/bin:$HOME/.cargo/bin:$PATH"

# Go 环境
export GO111MODULE=on
export GOROOT=/opt/develop/runtimes/go
export GOPATH=/opt/develop/Tools
export PATH="$PATH:$GOROOT/bin:$GOPATH/bin"
export GOPROXY="https://goproxy.cn,direct"

# uv (Python 包工具) - 修复补全命令（0.2.0+ 使用 generate-shell-completion）
if command -v uv &>/dev/null; then
    # 兼容新旧版本：优先尝试新命令，失败回退到旧命令
    if uv generate-shell-completion zsh &>/dev/null 2>&1; then
        eval "$(uv generate-shell-completion zsh)"
    elif uv --generate-shell-completion zsh &>/dev/null 2>&1; then
        eval "$(uv --generate-shell-completion zsh)"
    fi
fi

# pyenv (Python 版本管理)
if [[ -d "$HOME/.pyenv" ]]; then
    export PYENV_ROOT="$HOME/.pyenv"
    export PATH="$PYENV_ROOT/bin:$PATH"
    eval "$(pyenv init --path 2>/dev/null)" 2>/dev/null || true
    eval "$(pyenv init - 2>/dev/null)" 2>/dev/null || true
    eval "$(pyenv virtualenv-init - 2>/dev/null)" 2>/dev/null || true
fi

# kubectl (Kubernetes CLI)
if command -v kubectl &>/dev/null; then
    source <(kubectl completion zsh 2>/dev/null) 2>/dev/null || true
    alias k="kubectl"
    alias kga="kubectl get all"
    alias kaf="kubectl apply -f"
    alias krm="kubectl delete -f"
    alias klogs="kubectl logs -f"
    alias kns="kubectl config set-context --current --namespace"
fi

# ==============================================================================
# 实用别名与函数
# ==============================================================================
alias ll='ls -alF --color=auto'
alias la='ls -A --color=auto'
alias l='ls -CF --color=auto'
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

# Git 增强
alias gs='git status'
alias ga='git add'
alias gc='git commit -v'
alias gp='git push'
alias gl='git log --oneline --graph --all'

# Docker 快捷命令
alias dps='docker ps --format "table {{.ID}}\t{{.Names}}\t{{.Status}}\t{{.Ports}}"'
alias dim='docker images'
alias dclean='docker system prune -af --volumes'

# 代理开关
proxy-on() {
    export http_proxy="${PROXY_ADDR}"
    export https_proxy="${PROXY_ADDR}"
    export all_proxy="${PROXY_ADDR}"
    echo "✅ 全局代理已开启 (socks5://127.0.0.1:${PROXY_PORT})"
}
proxy-off() {
    unset http_proxy https_proxy all_proxy
    echo "📴 全局代理已关闭"
}

# ==============================================================================
# 语言与终端环境
# ==============================================================================
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
export EDITOR=${EDITOR:-vim}
export VISUAL=${VISUAL:-vim}

# ==============================================================================
# Oh My Zsh 核心加载（仅加载框架，插件由 Zinit 管理）
# ==============================================================================
if [[ -d "$ZSH" ]]; then
    source "$ZSH/oh-my-zsh.sh"
else
    echo "⚠️ Oh My Zsh 未安装到 $ZSH，跳过加载"
fi

# ==============================================================================
# 启动后自动消息（修复插件计数：异步加载需延迟统计）
# ==============================================================================
if [[ -z "$TMUX" && "$TERM_PROGRAM" != "vscode" ]]; then
    # 延迟 300ms 统计真实加载插件数（Zinit 异步加载特性）
    (sleep 0.3; PLUGIN_COUNT=$(zinit loaded 2>/dev/null | grep -c '^' || echo "0"); 
     echo -e "\033[0;36m✨ Zsh 启动完成 | 代理端口: ${PROXY_PORT} | 插件: ${PLUGIN_COUNT} 个 (异步加载中)\033[0m") &
fi
```

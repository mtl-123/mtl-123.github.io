---
title: Python uv 使用笔记
date: 2025-05-21 13:01:00
permalink: /pages/889785/
categories:
  - 《Python uv 使用笔记》
tags:
  -  uv
author:
  name: MeiChen
  link: https://github.com/mtl-123
---


# Python uv 工具使用指南


## 一、什么是 uv？为什么要用它？

### 1. 基本概念
`uv` 是由 Rust 构建的新一代 Python 包管理工具，定位为 `pip`、`virtualenv`、`pip-tools` 等传统工具的替代品，由 Astral 公司开发维护。


### 2. 核心作用与用途
- **虚拟环境管理**：创建、激活、切换 Python 虚拟环境
- **依赖管理**：安装、更新、删除项目依赖，生成依赖锁文件
- **项目运行**：直接运行 Python 脚本（自动关联虚拟环境）
- **工具调度**：全局安装/运行 Python 工具（替代 `pipx`）


### 3. 能解决什么问题？
- 传统工具（`pip`/`virtualenv`）速度慢：依赖解析和安装耗时久
- 依赖管理混乱：版本冲突、锁文件不一致
- 跨平台体验差：Windows/Linux/macOS 命令不统一
- 工具链分散：需要同时掌握 `pip`、`virtualenv`、`pipx` 等工具


### 4. 为什么选择 uv？
- **速度极快**：Rust 实现的依赖解析引擎，比 `pip` 快 10-100 倍
- **兼容性强**：完全兼容 `pip` 生态（支持 `requirements.txt`、`pyproject.toml`）
- **功能集成**：一个工具搞定虚拟环境+依赖管理+运行+工具调度
- **跨平台一致**：Windows/macOS/Linux 命令统一，无额外学习成本
- **单文件部署**：无需依赖 Python 环境，直接下载二进制文件即可使用


## 二、多平台安装方法

### 1. macOS / Linux（推荐方式）# 脚本自动安装（会检测系统并安装对应版本）
curl -LsSf https://astral.sh/uv/install.sh | sh

# 安装完成后配置环境变量（根据提示，示例为 bash/zsh）
source $HOME/.local/bin/env

### 2. Windows（PowerShell）# 执行安装脚本（需管理员权限）
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"

# 重启终端或手动添加路径到 PATH（默认路径：%USERPROFILE%\.cargo\bin）
### 3. 二进制手动安装（全平台通用）# 1. 下载对应平台的二进制包（从 https://github.com/astral-sh/uv/releases 选择版本）
# 示例：Linux x86_64
wget https://github.com/astral-sh/uv/releases/download/0.7.11/uv-x86_64-unknown-linux-gnu.tar.gz

# 2. 解压到系统可执行目录（如 /usr/local/bin 或 ~/.local/bin）
sudo tar -xf uv-x86_64-unknown-linux-gnu.tar.gz -C /usr/local/bin

# 3. 验证安装
uv --version  # 输出类似：uv 0.7.11

## 三、环境变量配置（必看）

### 1. 国内镜像源加速（解决下载慢问题）
#### （1）临时使用（单次命令）# 安装依赖时指定镜像
uv add --default-index https://pypi.tuna.tsinghua.edu.cn/simple requests
#### （2）全局配置（所有项目生效）# Linux/macOS（bash/zsh）
echo 'export UV_INDEX_URL=https://pypi.tuna.tsinghua.edu.cn/simple' >> ~/.bashrc
source ~/.bashrc

# Windows（PowerShell）
$env:UV_INDEX_URL = "https://pypi.tuna.tsinghua.edu.cn/simple"
# 永久生效（需管理员权限）
[Environment]::SetEnvironmentVariable("UV_INDEX_URL", "https://pypi.tuna.tsinghua.edu.cn/simple", "User")
#### （3）项目级配置（仅当前项目生效）
在项目根目录的 `pyproject.toml` 中添加：[[tool.uv.index]]
url = "https://pypi.tuna.tsinghua.edu.cn/simple"  # 镜像地址
default = true  # 设置为默认源

### 2. 其他常用环境变量# 配置 Python 安装镜像（加速多版本 Python 下载）
export UV_PYTHON_INSTALL_MIRROR="https://gh-proxy.com/github.com/indygreg/python-build-standalone/releases/download"

# 强制使用系统 Python 而非 uv 管理的版本
export UV_SYSTEM_PYTHON=1

## 四、虚拟环境管理（核心流程）

### 1. 创建虚拟环境# 默认创建 .venv 目录（当前项目）
uv venv

# 指定 Python 版本（自动下载对应版本，需联网）
uv venv --python 3.12

# 指定虚拟环境目录
uv venv my-venv  # 会创建 my-venv 目录

### 2. 激活虚拟环境
#### （1）Linux / macOS# 默认 .venv 环境
source .venv/bin/activate  # bash/zsh
source .venv/bin/activate.fish  # fish 终端

# 自定义目录（如 my-venv）
source my-venv/bin/activate
#### （2）Windows# PowerShell（默认 .venv）
.venv\Scripts\Activate.ps1

# CMD（命令提示符）
.venv\Scripts\activate.bat

# 自定义目录（如 my-venv）
my-venv\Scripts\Activate.ps1
激活成功后，终端提示符会显示 `(.venv)` 或自定义环境名。


### 3. 退出虚拟环境deactivate  # 全平台通用

### 4. 删除虚拟环境
直接删除虚拟环境目录即可：# Linux/macOS
rm -rf .venv

# Windows
rmdir /s /q .venv

## 五、项目初始化与依赖管理

### 1. 初始化新项目# 创建项目目录并生成 pyproject.toml
uv init my-project --python 3.12
cd my-project  # 进入项目目录

# 此时目录结构：
# my-project/
# └── pyproject.toml  # 项目配置文件（记录依赖）

### 2. 添加依赖# 安装最新版本（自动更新 pyproject.toml 和 uv.lock）
uv add requests

# 安装指定版本
uv add flask==2.3.3

# 安装开发依赖（仅开发环境需要，如测试工具）
uv add --dev pytest

# 兼容 pip 命令（不更新 pyproject.toml，仅安装到环境）
uv pip install django  # 等价于 pip install django

### 3. 更新依赖# 更新单个依赖到最新版本
uv update requests

# 更新所有依赖到兼容版本
uv update

# 强制刷新所有依赖（重新解析并生成锁文件）
uv sync --refresh

### 4. 删除依赖# 从项目中删除依赖（更新 pyproject.toml）
uv remove requests

# 仅从当前环境卸载（不更新配置文件）
uv pip uninstall flask

### 5. 查看依赖# 列出当前环境已安装的依赖
uv pip list

# 查看依赖树（显示依赖关系）
uv tree

# 查看某个依赖的详细信息
uv pip show requests

### 6. 同步依赖（团队协作/部署必备）# 根据 pyproject.toml 和 uv.lock 安装依赖（确保环境一致）
uv sync

# 部署到生产环境（忽略开发依赖）
uv sync --production

## 六、运行项目与脚本

### 1. 直接运行脚本（无需手动激活环境）# 自动使用项目的 .venv 环境运行
uv run python app.py

# 传递参数
uv run python app.py --port 8080

# 运行模块
uv run -m http.server 8000

### 2. 激活环境后运行（传统方式）# 先激活环境
source .venv/bin/activate  # Linux/macOS
# 或 .venv\Scripts\Activate.ps1  # Windows

# 直接运行
python app.py

## 七、全局工具管理（替代 pipx）

### 1. 安装全局工具# 安装工具到 uv 专属目录（不污染系统 Python）
uv tool install black  # 代码格式化工具
uv tool install ruff   # 代码检查工具

### 2. 运行全局工具# 方式1：通过 uv tool run 运行
uv tool run black --check .

# 方式2：通过 uvx 快捷运行（无需提前安装）
uvx black .  # 自动下载并运行 black（临时使用）
uvx ruff format .  # 直接运行 ruff 的 format 命令

### 3. 卸载全局工具uv tool uninstall black

## 八、兼容旧项目（requirements.txt）

### 1. 从 requirements.txt 安装依赖# 创建虚拟环境
uv venv

# 安装 requirements.txt 中的依赖
uv pip install -r requirements.txt

### 2. 生成 requirements.txt（冻结当前环境）# 等价于 pip freeze
uv pip freeze > requirements.txt

## 九、高级功能

### 1. 多版本 Python 管理# 安装指定版本 Python（无需手动下载）
uv python install 3.13.0

# 列出已安装的 Python 版本
uv python list

# 使用指定版本运行脚本
uvx python@3.13.0 -c "print('使用 Python 3.13 运行')"

### 2. 工作区模式（Monorepo 多项目管理）
在项目根目录的 `pyproject.toml` 中配置：[tool.uv.workspace]
members = ["packages/*"]  # 包含的子项目目录
exclude = ["packages/tests"]  # 排除的目录作用：多项目共享依赖锁文件，减少重复下载，统一依赖版本。


### 3. 缓存管理# 查看缓存目录
uv cache dir

# 清除所有缓存（释放空间）
uv cache clean

# 删除未使用的缓存
uv cache purge

## 十、从传统工具迁移

### 1. 从 pip + virtualenv 迁移# 1. 导出旧环境依赖
pip freeze > requirements.txt

# 2. 用 uv 创建新环境并安装
uv venv
uv pip install -r requirements.txt

# 3. （可选）迁移到 pyproject.toml 管理
uv add -r requirements.txt  # 将依赖添加到 pyproject.toml

### 2. 从 conda 迁移# 1. 导出 conda 环境依赖
conda list -e > requirements.txt

# 2. 用 uv 重建环境
uv venv --python 3.12
uv pip install -r requirements.txt

## 十一、总结：uv 核心工作流
1. 安装 uv 并配置国内镜像
2. 创建项目：`uv init my-project && cd my-project`
3. 创建虚拟环境：`uv venv`
4. 添加依赖：`uv add 依赖名`
5. 运行项目：`uv run python 脚本名.py`
6. 团队协作：提交 `pyproject.toml` 和 `uv.lock`，他人通过 `uv sync` 同步环境

通过这套流程，可高效完成 Python 项目的环境管理与依赖维护，大幅提升开发效率。

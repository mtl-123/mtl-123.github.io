---
title: WSL_åå°è¿è¡Œä¸ç½‘ç»œè®¿é—®
date: 2025-06-03 16:15:26
permalink: /pages/f6c3e3/
categories:
  - ç³»ç»Ÿ
  - ç³»ç»Ÿ
  - Windows
tags:
  - WSL_åå°è¿è¡Œä¸ç½‘ç»œè®¿é—®
author:
  name: MeiChen
  link: https://github.com/mtl-123
---

---


# âš™ï¸ WSL åå°è¿è¡Œä¸ç½‘ç»œè®¿é—®é…ç½®æŒ‡å—

> ğŸ’¡ æœ¬æ–‡æ¡£è®²è§£å¦‚ä½•è®© WSL åœ¨åå°æŒç»­è¿è¡Œï¼Œå¹¶å®ç°ä»å±€åŸŸç½‘è®¿é—® WSL å†…éƒ¨æœåŠ¡ã€‚

---

## ç¬¬ä¸€ç« ï¼šä¿æŒ WSL åœ¨åå°æŒç»­è¿è¡Œ

> ğŸ“Œ å½“é€€å‡ºç»ˆç«¯åï¼ŒWSL å¯èƒ½ä¼šè‡ªåŠ¨å…³é—­ï¼Œå¯¼è‡´ SSH æˆ–å…¶ä»–æœåŠ¡ä¸­æ–­ã€‚

### 1.1 è§£å†³æ–¹æ¡ˆæ¦‚è¿°

ä¸ºäº†è®© WSL æŒç»­è¿è¡Œï¼Œæˆ‘ä»¬é‡‡ç”¨ `.vbs` è„šæœ¬åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œä¸€ä¸ª WSL ç»ˆç«¯è¿›ç¨‹ï¼Œé˜²æ­¢ WSL å› æ— æ´»åŠ¨è¿›ç¨‹è€Œå…³é—­ã€‚

---

### 1.2 åˆ›å»ºåå°è¿è¡Œè„šæœ¬

#### æ–‡ä»¶åï¼š`start-wsl-background.vbs`

```vbs
Set objShell = CreateObject("WScript.Shell")
objShell.Run "cmd /c wsl", 0, False
```

ğŸ“Œ **è¯´æ˜ï¼š**

- `cmd /c wsl`ï¼šæ‰§è¡Œä¸€æ¬¡ `wsl` å‘½ä»¤ï¼Œè¿›å…¥é»˜è®¤å‘è¡Œç‰ˆ
- `0`ï¼šè¡¨ç¤ºçª—å£éšè—è¿è¡Œ
- `False`ï¼šä¸ç­‰å¾…è„šæœ¬æ‰§è¡Œå®Œæˆ

---

### 1.3 è®¾ç½®å¼€æœºè‡ªå¯åŠ¨

1. æŒ‰ä¸‹ `Win + R` è¾“å…¥ `shell:startup` æ‰“å¼€â€œå¯åŠ¨â€æ–‡ä»¶å¤¹
2. å°†ä¸Šè¿° `.vbs` æ–‡ä»¶å¤åˆ¶åˆ°è¯¥æ–‡ä»¶å¤¹ä¸­

âœ… **æ•ˆæœï¼š**
- Windows å¼€æœºåè‡ªåŠ¨é™é»˜è¿è¡Œ WSL
- å³ä½¿å…³é—­ç»ˆç«¯ï¼ŒWSL ä¹Ÿä¸ä¼šé€€å‡º

---

## ç¬¬äºŒç« ï¼šè®©å®¿ä¸»æœºåŠå±€åŸŸç½‘è®¿é—® WSL ä¸­çš„æœåŠ¡

> ğŸ’¡ ç¤ºä¾‹ï¼šä½ åœ¨ WSL ä¸­è¿è¡Œäº†ä¸€ä¸ª Python HTTP æœåŠ¡ç›‘å¬åœ¨ `8000` ç«¯å£ï¼Œå¦‚ä½•è®©å±€åŸŸç½‘è®¿é—®ï¼Ÿ

---

### 2.1 åœ¨ WSL ä¸­å¯åŠ¨æœåŠ¡

```bash
nohup python3 -m http.server 8000 &
```

---

### 2.2 è·å– WSL çš„ IP åœ°å€

```bash
hostname -I
```

å‡è®¾è¾“å‡ºä¸ºï¼š

```
172.27.250.42
```

---

## ç¬¬ä¸‰ç« ï¼šé…ç½® Windows ç«¯å£è½¬å‘ï¼ˆPort Proxyï¼‰

---

### 3.1 è·å– WSL ç½‘å¡åç§°

åœ¨ PowerShell ä¸­æ‰§è¡Œï¼š

```powershell
ipconfig /all
```

æ‰¾åˆ°ç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ï¼š

```
ä»¥å¤ªç½‘é€‚é…å™¨ vEthernet (WSL (Hyper-V firewall)):

   IPv4 åœ°å€ . . . . . . . . . . . . : 172.27.240.1(é¦–é€‰)
```

---

### 3.2 æ·»åŠ é˜²ç«å¢™è§„åˆ™å…è®¸è®¿é—®

ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShell å¹¶æ‰§è¡Œï¼š

```powershell
New-NetFirewallRule -DisplayName "WSL" -Direction Inbound -InterfaceAlias "vEthernet (WSL (Hyper-V firewall))" -Action Allow
```

---

### 3.3 ã€æ–°å¢ã€‘æ£€æŸ¥å®¿ä¸»æœºç«¯å£æ˜¯å¦è¢«å ç”¨ï¼ˆéå¸¸é‡è¦ï¼ï¼‰

åœ¨æ·»åŠ  Port Proxy è§„åˆ™å‰ï¼Œå¿…é¡»ç¡®ä¿ä½ é€‰æ‹©çš„ `listenport`ï¼ˆå¦‚ `8000`ï¼‰æ²¡æœ‰è¢« Windows ä¸Šçš„ç¨‹åºå ç”¨ã€‚

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ `netstat` æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ

```powershell
netstat -ano | findstr :8000
```

å¦‚æœè¾“å‡ºä¸ºç©ºï¼Œåˆ™è¯´æ˜ç«¯å£æœªè¢«å ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ã€‚

å¦‚æœè¾“å‡ºç±»ä¼¼ï¼š

```
TCP    0.0.0.0:8000           0.0.0.0:0              LISTENING       1234
```

è¯´æ˜ç«¯å£å·²è¢«å ç”¨ï¼Œä½ å¯ä»¥æŸ¥çœ‹ PID `1234` æ˜¯å“ªä¸ªç¨‹åºï¼š

```powershell
tasklist | findstr 1234
```

---

### 3.4 é…ç½®ç«¯å£è½¬å‘ï¼ˆPort Proxyï¼‰

ç¡®è®¤ç«¯å£å¯ç”¨åæ‰§è¡Œï¼š

```powershell
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=8000 connectaddress=172.27.250.42 connectport=8000
```

---

### 3.5 æŸ¥çœ‹å½“å‰ Port Proxy è§„åˆ™

```powershell
netsh interface portproxy show all
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
ä¾¦å¬ ipv4:                 è¿æ¥åˆ° ipv4:

åœ°å€            ç«¯å£        åœ°å€            ç«¯å£
--------------- ----------  --------------- ----------
0.0.0.0         22          172.20.146.51   22
0.0.0.0         8000        172.27.250.42   8000
```

---

### 3.6 åˆ é™¤æŸä¸ª Port Proxy è§„åˆ™ï¼ˆå¦‚éœ€ï¼‰

```powershell
netsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=8000
```

---

### 3.7 æ‰¹é‡æ·»åŠ å¤šä¸ªç«¯å£è½¬å‘è§„åˆ™ï¼ˆæ¨èï¼‰

ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª PowerShell è„šæœ¬æ–‡ä»¶æ¥ä¸€æ¬¡æ€§æ·»åŠ å¤šä¸ªæœåŠ¡ç«¯å£ã€‚

#### ç¤ºä¾‹è„šæœ¬ï¼š`setup-portproxy.ps1`

```powershell
# å…ˆæ¸…é™¤æ—§è§„åˆ™ï¼ˆå¯é€‰ï¼‰
# netsh interface portproxy reset all

# æ·»åŠ å¤šä¸ªç«¯å£è½¬å‘è§„åˆ™
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=80    connectaddress=172.27.250.42 connectport=80
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=22    connectaddress=172.27.250.42 connectport=22
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=3306  connectaddress=172.27.250.42 connectport=3306
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=8080  connectaddress=172.27.250.42 connectport=8080
```

ğŸ“Œ **ä½¿ç”¨æ–¹å¼ï¼š**

1. å°†ä¸Šè¿°å†…å®¹ä¿å­˜ä¸º `setup-portproxy.ps1`
2. å³é”® â†’ â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€

---

### 3.8 è®¾ç½®è„šæœ¬å¼€æœºè‡ªå¯ï¼ˆå¯é€‰ä½†æ¨èï¼‰

#### æ–¹æ³•ï¼šæ”¾å…¥â€œå¯åŠ¨â€æ–‡ä»¶å¤¹

1. æŒ‰ä¸‹ `Win + R` è¾“å…¥ `shell:startup` æ‰“å¼€â€œå¯åŠ¨â€æ–‡ä»¶å¤¹
2. åˆ›å»ºå¿«æ·æ–¹å¼æŒ‡å‘ä½ çš„ `.ps1` è„šæœ¬ï¼Œä¾‹å¦‚ï¼š

```text
PowerShell.exe -ExecutionPolicy Bypass -File "C:\scripts\setup-portproxy.ps1"
```

ğŸ“Œ **æ³¨æ„ï¼š**
- ç¡®ä¿è·¯å¾„æ­£ç¡®
- é¦–æ¬¡è¿è¡Œå‰å»ºè®®æµ‹è¯•è„šæœ¬æ˜¯å¦æ­£å¸¸å·¥ä½œ

---

## ç¬¬å››ç« ï¼šéªŒè¯æœåŠ¡æ˜¯å¦å¯è¾¾

---

### 4.1 åœ¨å®¿ä¸»æœºä¸Šæµ‹è¯•æœ¬åœ°è®¿é—®

```bash
telnet 127.0.0.1 8000
```

---

### 4.2 åœ¨å±€åŸŸç½‘è®¾å¤‡ä¸Šæµ‹è¯•è®¿é—®

```bash
telnet <Windowså®¿ä¸»æœºIP> 8000
```

ä¾‹å¦‚ï¼š

```bash
telnet 192.168.10.10 8000
```

å¦‚æœè¿æ¥æˆåŠŸï¼Œè¯´æ˜æœåŠ¡å·²å¼€æ”¾ï¼

---

## é™„å½• Aï¼šå¸¸ç”¨å‘½ä»¤æ±‡æ€»

| æ“ä½œ | å‘½ä»¤ |
|------|------|
| è·å– WSL IP åœ°å€ | `hostname -I` |
| æ·»åŠ é˜²ç«å¢™è§„åˆ™ | `New-NetFirewallRule -DisplayName "WSL" ...` |
| æ·»åŠ ç«¯å£è½¬å‘ | `netsh interface portproxy add v4tov4 ...` |
| æŸ¥çœ‹æ‰€æœ‰è½¬å‘è§„åˆ™ | `netsh interface portproxy show all` |
| åˆ é™¤æŒ‡å®šè½¬å‘è§„åˆ™ | `netsh interface portproxy delete v4tov4 ...` |
| æµ‹è¯•ç«¯å£è¿é€šæ€§ | `telnet <IP> <Port>` |
| æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ | `netstat -ano \| findstr :<Port>` |
| æŸ¥çœ‹è¿›ç¨‹ ID å¯¹åº”ç¨‹åº | `tasklist \| findstr <PID>` |

---

## é™„å½• Bï¼šå®Œæ•´è„šæœ¬æ¨¡æ¿ä¸‹è½½

ä½ å¯ä»¥å°†ä»¥ä¸‹å†…å®¹åˆ†åˆ«ä¿å­˜ä¸ºï¼š

- `start-wsl-background.vbs`ï¼šç”¨äºå¼€æœºè‡ªåŠ¨è¿è¡Œ WSL
- `setup-portproxy.ps1`ï¼šç”¨äºé…ç½®å¤šä¸ªç«¯å£è½¬å‘è§„åˆ™

### âœ… `start-wsl-background.vbs`

```vbs
Set objShell = CreateObject("WScript.Shell")
objShell.Run "cmd /c wsl", 0, False
```

### âœ… `setup-portproxy.ps1`

```powershell
# æ·»åŠ å¤šä¸ªç«¯å£è½¬å‘è§„åˆ™
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=80    connectaddress=172.27.250.42 connectport=80
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=22    connectaddress=172.27.250.42 connectport=22
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=3306  connectaddress=172.27.250.42 connectport=3306
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=8080  connectaddress=172.27.250.42 connectport=8080
```

---

å¦‚æœä½ å¸Œæœ›æˆ‘å¸®ä½ ç”Ÿæˆå®Œæ•´çš„ ZIP åŒ…æˆ– PDF æ ¼å¼æ–‡æ¡£ï¼Œæˆ–è€…ä½ æƒ³å°†è¿™äº›è„šæœ¬å°è£…æˆä¸€é”®å®‰è£…åŒ…ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼š

- WSL çš„å®é™… IP åœ°å€
- ä½ å¸¸ç”¨çš„ç«¯å£å·åˆ—è¡¨ï¼ˆå¦‚ 80, 22, 3306, 8080 ç­‰ï¼‰

æˆ‘å¯ä»¥ä¸ºä½ å®šåˆ¶å®Œæ•´éƒ¨ç½²å·¥å…· ğŸ‘‡
---
title: WSL_åå°è¿è¡Œä¸ç½‘ç»œè®¿é—®
date: 2025-06-03 16:15:26
permalink: /pages/f6c3e3/
categories:
  - ç³»ç»Ÿ
  - ç³»ç»Ÿ
  - Windows
tags:
  - WSL_åå°è¿è¡Œä¸ç½‘ç»œè®¿é—®
author:
  name: MeiChen
  link: https://github.com/mtl-123
---


## âœ… æ–‡æ¡£ç›®æ ‡

å¸®åŠ©ç”¨æˆ·å®ç°ä»¥ä¸‹ç›®æ ‡ï¼š

- ä¿æŒ WSL åœ¨åå°æŒç»­è¿è¡Œï¼ˆå³ä½¿å…³é—­ç»ˆç«¯ï¼‰
- å®ç°å±€åŸŸç½‘è®¿é—® WSL ä¸­çš„æœåŠ¡
- ç¡®ä¿é…ç½®é€»è¾‘æ¸…æ™°ã€æ“ä½œå¯éªŒè¯ã€æµç¨‹å®Œæ•´

---

# ğŸ“š WSL åå°è¿è¡Œä¸ç½‘ç»œè®¿é—®é…ç½®æ‰‹å†Œ

> ğŸ’¡ æœ¬æ–‡æ¡£æ—¨åœ¨æŒ‡å¯¼ Windows ç”¨æˆ·é…ç½® WSL2 å­ç³»ç»Ÿï¼Œå®ç°æœåŠ¡åå°å¸¸é©»è¿è¡Œï¼Œå¹¶é€šè¿‡å±€åŸŸç½‘è®¿é—®å…¶å†…éƒ¨æœåŠ¡ã€‚

---

## ç¬¬ä¸€ç« ï¼šéœ€æ±‚èƒŒæ™¯

### 1.1 é—®é¢˜æè¿°

- WSL é»˜è®¤åœ¨æ²¡æœ‰æ´»åŠ¨è¿›ç¨‹æ—¶ä¼šè‡ªåŠ¨å…³é—­
- å¯¼è‡´ SSHã€Web æœåŠ¡ç­‰æ— æ³•é•¿æœŸè¿è¡Œ
- å±€åŸŸç½‘è®¾å¤‡æ— æ³•ç›´æ¥è®¿é—® WSL ä¸­çš„æœåŠ¡

### 1.2 éœ€æ±‚ç›®æ ‡

| ç›®æ ‡ | æè¿° |
|------|------|
| âœ… æŒç»­è¿è¡Œ | å³ä½¿å…³é—­ç»ˆç«¯ï¼ŒWSL ä»æŒç»­è¿è¡Œ |
| âœ… æœ¬åœ°è®¿é—® | å®¿ä¸»æœºå¯ä»¥é€šè¿‡ IP + ç«¯å£è®¿é—®æœåŠ¡ |
| âœ… å±€åŸŸç½‘è®¿é—® | åŒä¸€å±€åŸŸç½‘çš„å…¶ä»–è®¾å¤‡ä¹Ÿèƒ½è®¿é—®è¯¥æœåŠ¡ |

---

## ç¬¬äºŒç« ï¼šå®ç°åŸç†

### 2.1 WSL è¿è¡Œæœºåˆ¶

- WSL2 æ˜¯ä¸€ä¸ªåŸºäº Hyper-V çš„è½»é‡çº§è™šæ‹Ÿæœº
- å½“æ²¡æœ‰æ´»è·ƒè¿›ç¨‹æ—¶ï¼Œæ•´ä¸ª Linux å­ç³»ç»Ÿä¼šè¢«ç»ˆæ­¢ï¼ˆç›¸å½“äºå…³æœºï¼‰

### 2.2 ç½‘ç»œæ¶æ„

```
[å±€åŸŸç½‘è®¾å¤‡] â€”â€” (TCP/IP) â€”â€” [Windows å®¿ä¸»æœº] â€”â€” (NAT) â€”â€” [WSL2 å­ç³»ç»Ÿ]
```

- WSL2 æœ‰ç§æœ‰ IPï¼ˆå¦‚ `172.x.x.x`ï¼‰
- Windows å®¿ä¸»æœºä½œä¸º NAT ç½‘å…³
- å¤–éƒ¨è®¿é—®éœ€è¦å€ŸåŠ© Port Proxy å’Œé˜²ç«å¢™è§„åˆ™

---

## ç¬¬ä¸‰ç« ï¼šè§£å†³æ–¹æ¡ˆæ¦‚è¿°

| æ¨¡å— | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| åå°è¿è¡Œ | ä½¿ç”¨ `.vbs` è„šæœ¬å¼€æœºå¯åŠ¨ WSL ç»ˆç«¯è¿›ç¨‹ |
| æœ¬åœ°è®¿é—® | ä½¿ç”¨ `netsh interface portproxy` æ˜ å°„ç«¯å£ |
| å±€åŸŸç½‘è®¿é—® | æ·»åŠ é˜²ç«å¢™å…¥ç«™è§„åˆ™å…è®¸å¤–éƒ¨è®¿é—® |

---

## ç¬¬å››ç« ï¼šè¯¦ç»†é…ç½®æ­¥éª¤

---

### 4.1 æŒç»­è¿è¡Œ WSLï¼ˆåå°å¸¸é©»ï¼‰

#### 4.1.1 åˆ›å»ºåå°è„šæœ¬æ–‡ä»¶

æ–‡ä»¶åï¼š`start-wsl-background.vbs`

```vbs
Set objShell = CreateObject("WScript.Shell")
objShell.Run "cmd /c wsl", 0, False
```

ğŸ“Œ **è¯´æ˜ï¼š**

- `cmd /c wsl`ï¼šæ‰§è¡Œä¸€æ¬¡ `wsl` å‘½ä»¤ï¼Œè¿›å…¥é»˜è®¤å‘è¡Œç‰ˆ
- `0`ï¼šè¡¨ç¤ºçª—å£éšè—è¿è¡Œ
- `False`ï¼šä¸ç­‰å¾…è„šæœ¬æ‰§è¡Œå®Œæˆ

#### 4.1.2 è®¾ç½®å¼€æœºè‡ªå¯åŠ¨

1. æŒ‰ä¸‹ `Win + R` è¾“å…¥ `shell:startup` æ‰“å¼€â€œå¯åŠ¨â€æ–‡ä»¶å¤¹
2. å°†ä¸Šè¿° `.vbs` æ–‡ä»¶å¤åˆ¶åˆ°è¯¥æ–‡ä»¶å¤¹ä¸­

âœ… **æ•ˆæœï¼š**

- Windows å¼€æœºåè‡ªåŠ¨é™é»˜è¿è¡Œ WSL
- å³ä½¿å…³é—­ç»ˆç«¯ï¼ŒWSL ä¹Ÿä¸ä¼šé€€å‡º

---

### 4.2 è·å– WSL çš„ IP åœ°å€

åœ¨ WSL ä¸­æ‰§è¡Œï¼š

```bash
hostname -I
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
172.27.250.42
```

ğŸ“Œ **ç”¨é€”ï¼š**

- ç”¨äºåç»­é…ç½®ç«¯å£è½¬å‘çš„ç›®æ ‡åœ°å€

---

### 4.3 é…ç½®ç«¯å£è½¬å‘ï¼ˆPort Proxyï¼‰

#### 4.3.1 æ£€æŸ¥å®¿ä¸»æœºç«¯å£æ˜¯å¦è¢«å ç”¨

```powershell
netstat -ano | findstr :8000
```

å¦‚æœè¾“å‡ºä¸ºç©ºï¼Œåˆ™ç«¯å£å¯ç”¨ï¼›å¦åˆ™æ›´æ¢ç«¯å£å·ã€‚

#### 4.3.2 æ·»åŠ  Port Proxy è§„åˆ™

```powershell
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=8000 connectaddress=172.27.250.42 connectport=8000
```

ğŸ“Œ **å‚æ•°è¯´æ˜ï¼š**

| å‚æ•° | å«ä¹‰ |
|------|------|
| `listenaddress` | å®¿ä¸»æœºç›‘å¬åœ°å€ï¼ˆ0.0.0.0 è¡¨ç¤ºæ‰€æœ‰æ¥å£ï¼‰ |
| `listenport` | å®¿ä¸»æœºå¯¹å¤–æš´éœ²çš„ç«¯å£ |
| `connectaddress` | WSL å­ç³»ç»Ÿçš„ IP åœ°å€ |
| `connectport` | WSL å­ç³»ç»Ÿä¸­çš„æœåŠ¡ç«¯å£ |

#### 4.3.3 æŸ¥çœ‹å½“å‰ Port Proxy è§„åˆ™

```powershell
netsh interface portproxy show all
```

---

### 4.4 å…è®¸å¤–éƒ¨è®¿é—®ï¼ˆæ·»åŠ é˜²ç«å¢™è§„åˆ™ï¼‰

ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShell å¹¶æ‰§è¡Œï¼š

```powershell
New-NetFirewallRule -DisplayName "Allow TCP Port 8000" `
    -Direction Inbound -Protocol TCP -LocalPort 8000 -Action Allow -Profile Any
```

ğŸ“Œ **ä½œç”¨ï¼š**

- å…è®¸å¤–éƒ¨è®¾å¤‡é€šè¿‡ TCP åè®®è®¿é—®æœ¬æœºçš„ `8000` ç«¯å£
- å¯¹åº”äºå±€åŸŸç½‘å†…è®¾å¤‡è®¿é—®å®¿ä¸»æœºçš„ IP + ç«¯å£

---

### 4.5 è‡ªåŠ¨åŒ–è„šæœ¬æ¨¡æ¿ï¼ˆæ¨èï¼‰

#### ç¤ºä¾‹è„šæœ¬ï¼š`setup-portproxy.ps1`

```powershell
# è®¾ç½®è½¬å‘ç«¯å£ï¼ˆè¯·æ ¹æ®éœ€è¦ä¿®æ”¹ï¼‰
$ListenPort = 8000
$ConnectIP = "172.27.250.42"
$ConnectPort = 8000

# æ·»åŠ  Port Proxy è§„åˆ™
netsh interface portproxy add v4tov4 `
    listenaddress=0.0.0.0 `
    listenport=$ListenPort `
    connectaddress=$ConnectIP `
    connectport=$ConnectPort

# æ·»åŠ é˜²ç«å¢™å…¥ç«™è§„åˆ™
New-NetFirewallRule -DisplayName "Allow TCP Port $ListenPort" `
    -Protocol TCP -LocalPort $ListenPort `
    -Action Allow -Profile Any

Write-Host "âœ… å·²æ·»åŠ  Port Proxy å’Œé˜²ç«å¢™è§„åˆ™ï¼Œç«¯å£: $ListenPort"
```

ğŸ“Œ **ä½¿ç”¨æ–¹å¼ï¼š**

- å³é”® â†’ â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€

---

### 4.6 è®¾ç½®è„šæœ¬å¼€æœºè‡ªå¯ï¼ˆå¯é€‰ä½†æ¨èï¼‰

1. æŒ‰ä¸‹ `Win + R` è¾“å…¥ `shell:startup` æ‰“å¼€â€œå¯åŠ¨â€æ–‡ä»¶å¤¹
2. åˆ›å»ºå¿«æ·æ–¹å¼æŒ‡å‘ä½ çš„ `.ps1` è„šæœ¬ï¼Œä¾‹å¦‚ï¼š

```text
PowerShell.exe -ExecutionPolicy Bypass -File "C:\scripts\setup-portproxy.ps1"
```

ğŸ“Œ **æ³¨æ„ï¼š**

- ç¡®ä¿è·¯å¾„æ­£ç¡®
- é¦–æ¬¡è¿è¡Œå‰å»ºè®®æµ‹è¯•è„šæœ¬æ˜¯å¦æ­£å¸¸å·¥ä½œ

---

## ç¬¬äº”ç« ï¼šéªŒè¯æœåŠ¡æ˜¯å¦å¯è¾¾

### 5.1 åœ¨å®¿ä¸»æœºä¸Šæµ‹è¯•æœ¬åœ°è®¿é—®

```bash
telnet 127.0.0.1 8000
```

### 5.2 åœ¨å±€åŸŸç½‘è®¾å¤‡ä¸Šæµ‹è¯•è®¿é—®

```bash
telnet <å®¿ä¸»æœºIP> 8000
```

ä¾‹å¦‚ï¼š

```bash
telnet 192.168.1.100 8000
```

âœ… **é¢„æœŸç»“æœï¼š**

- æˆåŠŸè¿æ¥å¹¶çœ‹åˆ° HTTP æœåŠ¡å“åº”æˆ–æ–‡ä»¶åˆ—è¡¨

---

## é™„å½• Aï¼šå¸¸ç”¨å‘½ä»¤æ±‡æ€»

| æ“ä½œ | å‘½ä»¤ |
|------|------|
| è·å– WSL IP åœ°å€ | `hostname -I` |
| æ·»åŠ  Port Proxy è§„åˆ™ | `netsh interface portproxy add ...` |
| æŸ¥çœ‹ Port Proxy åˆ—è¡¨ | `netsh interface portproxy show all` |
| åˆ é™¤ Port Proxy è§„åˆ™ | `netsh interface portproxy delete ...` |
| æ·»åŠ é˜²ç«å¢™è§„åˆ™ | `New-NetFirewallRule ...` |
| æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ | `netstat -ano \| findstr :<Port>` |
| æŸ¥çœ‹è¿›ç¨‹ ID å¯¹åº”ç¨‹åº | `tasklist \| findstr <PID>` |
| æµ‹è¯•æœ¬åœ°è®¿é—® | `telnet 127.0.0.1 <Port>` |
| æµ‹è¯•å±€åŸŸç½‘è®¿é—® | `telnet <å®¿ä¸»æœºIP> <Port>` |

---

## é™„å½• Bï¼šå®Œæ•´è„šæœ¬æ¨¡æ¿ä¸‹è½½

ä½ å¯ä»¥å°†ä»¥ä¸‹å†…å®¹åˆ†åˆ«ä¿å­˜ä¸ºï¼š

- `start-wsl-background.vbs`ï¼šç”¨äºå¼€æœºè‡ªåŠ¨è¿è¡Œ WSL
- `setup-portproxy.ps1`ï¼šç”¨äºé…ç½®å¤šä¸ªç«¯å£è½¬å‘è§„åˆ™

### âœ… `start-wsl-background.vbs`

```vbs
Set objShell = CreateObject("WScript.Shell")
objShell.Run "cmd /c wsl", 0, False
```

### âœ… `setup-portproxy.ps1`

```powershell
# æ·»åŠ å¤šä¸ªç«¯å£è½¬å‘è§„åˆ™
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=80    connectaddress=172.27.250.42 connectport=80
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=22    connectaddress=172.27.250.42 connectport=22
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=3306  connectaddress=172.27.250.42 connectport=3306
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=8080  connectaddress=172.27.250.42 connectport=8080
```

---

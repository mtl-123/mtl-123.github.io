---
title: network_configure
date: 2025-05-29 10:17:36
permalink: /pages/e61a28/
categories:
  - 系统
  - 系统
  - Linux
tags:
  - network_configure
author:
  name: MeiChen
  link: https://github.com/mtl-123
---


# 在无网络环境下安装 NetworkManager

---

## 准备工作

1. 将刻录好的系统 ISO 镜像启动盘插入电脑
2. 执行以下命令查找 U 盘盘符：

   ```bash
   sudo fdisk -l
   ```

---

## 详细操作步骤

### 1. 挂载系统 ISO 镜像

### 找到iso镜像位置

```
m@m:~$ lsblk -l
NAME         MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda            8:0    0  100G  0 disk
sda1           8:1    0  512M  0 part /boot/efi
sda2           8:2    0  488M  0 part /boot
sda3           8:3    0   99G  0 part
sr0           11:0    1  3.7G  0 rom  # 镜像驱动名称 类型为 TYPE ：rom
m--vg-root   254:0    0   98G  0 lvm  /
m--vg-swap_1 254:1    0  976M  0 lvm  [SWAP]
```

```bash
# 创建挂载点目录
sudo mkdir -p /mnt/cdrom

# 挂载 ISO 镜像（需替换为实际路径）
sudo mount -o loop /path/to/your.iso /mnt/cdrom
```

### 2. 配置本地软件源

```bash
# 使用 apt-cdrom 注册源 （关键步骤）：
sudo apt-cdrom add --cdrom=/mnt/cdrom

Using CD-ROM mount point /media/cdrom/
Identifying... [3be024da5238bc8ca2f1ffc527dee77b-2]
Scanning disc for index files...
Found 3 package indexes, 0 source indexes, 0 translation indexes and 0 signatures
This disc is called:
'Debian GNU/Linux 12.10.0 _Bookworm_ - Official amd64 DVD Binary-1 with firmware 20250315-10:10'
Reading Package Indexes... Done
Writing new source list
Source list entries for this disc are:
deb cdrom:[Debian GNU/Linux 12.10.0 _Bookworm_ - Official amd64 DVD Binary-1 with firmware 20250315-10:10]/ bookworm contrib main non-free-firmware
Repeat this process for the rest of the CDs in your set.
```

```bash
# 备份原始源列表（可选）
sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak

# 配置本地源（以 Ubuntu 20.04 为例）
sudo tee /etc/apt/sources.list << 'EOF'
deb [trusted=yes] file:/mnt/cdrom focal main restricted
EOF
```

### 检查挂在成功了

```bash
m@m:~$ df -TH
Filesystem             Type      Size  Used Avail Use% Mounted on
udev                   devtmpfs  4.2G     0  4.2G   0% /dev
tmpfs                  tmpfs     833M  1.2M  832M   1% /run
/dev/mapper/m--vg-root ext4      104G  7.4G   91G   8% /
tmpfs                  tmpfs     4.2G     0  4.2G   0% /dev/shm
tmpfs                  tmpfs     5.3M     0  5.3M   0% /run/lock
/dev/sda2              ext2      478M  154M  298M  35% /boot
/dev/sda1              vfat      536M  6.2M  530M   2% /boot/efi
tmpfs                  tmpfs     833M   62k  833M   1% /run/user/112
tmpfs                  tmpfs     833M   58k  833M   1% /run/user/1000
/dev/loop0             iso9660   4.0G  4.0G     0 100% /media/cdrom0 # 这里是挂在的镜像
```

### 3. 更新软件包列表

```bash
sudo apt-get update
```

### 4. 安装 NetworkManager

```bash
# 推荐安装方式（最小化依赖）
sudo apt-get install --no-install-recommends network-manager

# 完整安装（解决依赖问题时使用）
sudo apt-get install network-manager*
```

### 5. 启动并启用服务

```bash
sudo systemctl start NetworkManager
sudo systemctl enable NetworkManager
```

### 6. 使用 nmtui 配置网络

```bash
sudo nmtui
```

**操作指南**：

1. 选择 `Edit a connection`
2. 选择网络接口（如 `eth0`/`enp0s3`）
3. 配置 IPv4/IPv6：
   - 将 `Automatic` 改为 `Manual`
   - 添加 IP 地址、网关、DNS
4. 保存后选择 `Activate a connection` 重启连接

---

## 验证与恢复

### 1. 网络状态验证

```bash
ip addr show          # 检查 IP 分配
ping -c 4 8.8.8.8     # 测试外网连通性
```

### 2. 恢复原始源（可选）

```bash
sudo mv /etc/apt/sources.list.bak /etc/apt/sources.list
sudo umount /mnt/cdrom
sudo apt-get update
```

---

## 注意事项与扩展

### 关键注意事项

1. **版本一致性**：确保 ISO 镜像版本与系统一致（如 Ubuntu 20.04 对应 `focal`）
2. **依赖问题处理**：
   - 若遇依赖缺失，尝试完整安装 `network-manager*`
   - 手动下载依赖包：参考  的离线包安装方法
3. **服务器版适配**：

   ```bash
   sudo apt-get install network-manager-gnome  # 启用 GUI 组件
   ```

### 常用维护命令

```bash
sudo systemctl restart NetworkManager       # 重启服务
sudo systemctl status NetworkManager        # 检查状态
```

---

## 参考资料

- 离线安装包获取
- 手动下载依赖包方法
- NetworkManager 工具说明

> **最终提示**：通过 `nmtui` 文本界面可完全脱离图形环境完成配置，特别适合服务器场景使用。

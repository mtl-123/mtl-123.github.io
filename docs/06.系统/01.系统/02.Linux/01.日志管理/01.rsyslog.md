---
title: rsyslog
date: 2025-06-05 10:02:38
permalink: /pages/718a86/
categories:
  - 系统
  - 系统
  - Linux
  - 日志管理
tags:
  - Rsyslog
author:
  name: MeiChen
  link: https://github.com/mtl-123
---

# Rsyslog 使用手册

- 是安装rsyslog之前先认识一下 linux系统下的常见日志格式

---

# Linux 系统常见日志格式与日志文件说明

在 Linux 系统中，日志（logs）用于记录系统运行状态、应用程序行为、安全事件等信息。不同的服务和组件会生成不同格式的日志。

## 一、常见日志格式

### 1. `syslog` 格式

这是最常见的日志格式之一，由 syslog 守护进程（如 rsyslog、syslog-ng）生成。

#### 示例

```
<34>1 2025-04-05T10:00:00Z myhost app - - [meta sequenceId="1"] Hello, this is a log message.
```

#### 各字段含义

| 字段 | 含义 |
|------|------|
| `<34>` | PRI（Priority），优先级代码 |
| `1` | VERSION（版本号，通常为1） |
| `2025-04-05T10:00:00Z` | TIMESTAMP（ISO8601时间戳） |
| `myhost` | HOSTNAME（主机名） |
| `app` | APP-NAME（产生日志的应用名称） |
| `-` | PROCID（进程ID，可为空） |
| `-` | MSGID（消息ID） |
| `[meta sequenceId="1"]` | SD-ELEMENTS（结构化数据） |
| `Hello, this is a log message.` | MSG（日志内容） |

### 2. `Common Log Format (CLF)` - 常用于 Web 服务器日志（如 Apache）

#### 示例

```
127.0.0.1 user-ident auth-user-id [05/Apr/2025:10:00:00 +0000] "GET /index.html HTTP/1.1" 200 512
```

#### 各字段含义

| 字段 | 含义 |
|------|------|
| `127.0.0.1` | 客户端 IP 地址 |
| `user-ident` | RFC1413 身份标识 |
| `auth-user-id` | 认证用户名 |
| `[05/Apr/2025:10:00:00 +0000]` | 时间戳 |
| `"GET /index.html HTTP/1.1"` | 请求行 |
| `200` | 响应状态码 |
| `512` | 响应大小（字节） |

### 3. `JSON` 格式

现代应用和服务常使用 JSON 格式输出日志，便于解析。

#### 示例

```json
{
  "timestamp": "2025-04-05T10:00:00Z",
  "level": "INFO",
  "source": "auth",
  "message": "User login successful",
  "user": "alice"
}
```

---

## 二、常见日志文件路径

| 日志文件路径 | 说明 |
|--------------|------|
| `/var/log/messages` | 系统主日志文件（CentOS/RHEL） |
| `/var/log/syslog` | 系统主日志文件（Debian/Ubuntu） |
| `/var/log/auth.log` | 认证相关日志（登录、sudo 等，Debian/Ubuntu） |
| `/var/log/secure` | 安全日志（如 SSH 登录尝试，CentOS/RHEL） |
| `/var/log/dmesg` | 内核环缓冲区日志 |
| `/var/log/kern.log` | 内核日志 |
| `/var/log/boot.log` | 系统启动日志 |
| `/var/log/cron` | 定时任务（cron）日志 |
| `/var/log/httpd/access_log` 或 `/var/log/apache2/access.log` | Apache 访问日志 |
| `/var/log/httpd/error_log` 或 `/var/log/apache2/error.log` | Apache 错误日志 |
| `/var/log/nginx/access.log` | Nginx 访问日志 |
| `/var/log/nginx/error.log` | Nginx 错误日志 |
| `/var/log/mysqld.log` 或 `/var/log/mysql/error.log` | MySQL 数据库日志 |
| `/var/log/journal/`（systemd-journald） | systemd 的二进制日志目录 |
| `/var/log/faillog` | 失败登录尝试日志 |
| `/var/log/lastlog` | 用户最后一次登录记录 |
| `/var/log/wtmp` | 登录历史（使用 `last` 命令查看） |
| `/var/log/btmp` | 失败登录记录（使用 `lastb` 命令查看） |

---

## 三、常用日志管理工具

| 工具 | 说明 |
|------|------|
| `rsyslog` | 高性能 syslog 实现，支持 TCP、SSL、MySQL 输出等 |
| `syslog-ng` | 另一个流行的 syslog 替代实现 |
| `journalctl` | systemd 提供的命令行日志查看工具 |
| `logrotate` | 日志轮转工具，防止日志文件过大 |
| `auditd` | Linux 审计守护进程，用于安全审计日志 |
| `rsync`, `scp` | 日志备份常用工具 |
| `grep`, `awk`, `tail`, `cat` | 常用日志分析命令 |

---

## 四、常用命令示例

```bash
# 查看系统主日志
tail -f /var/log/syslog         # Ubuntu/Debian
tail -f /var/log/messages       # CentOS/RHEL

# 查看认证日志
tail -f /var/log/auth.log       # Ubuntu/Debian
tail -f /var/log/secure         # CentOS/RHEL

# 使用 journalctl 查看 systemd 日志
journalctl -u sshd.service      # 查看某个服务的日志
journalctl -b                   # 查看本次启动的日志
journalctl --since "1 hour ago"

# 查看最近登录用户
last

# 查看失败登录尝试
lastb
```

---

## 五、小结

Linux 系统下的日志格式多样，常见的包括 `syslog`、`CLF` 和 `JSON` 格式。日志文件主要存放在 `/var/log/` 目录下，根据发行版和配置可能有所不同。使用合适的工具可以有效管理和分析这些日志，帮助排查问题、监控系统健康状况和进行安全审计。

---

## 安装rsyslog

`sudo apt install rsyslog -y`

## 查看安装的程序位置

```bash
┬─[root@m:~]─[02:55:46]
╰─># whereis  rsyslog
rsyslog: /usr/lib/x86_64-linux-gnu/rsyslog /usr/lib/rsyslog /usr/share/rsyslog
```

## rsyslog的配置

- rsyslog 的主要配置文件位于 `/etc/rsyslog/slog.conf`

## 查询服务是否启动

`ps aux | grep "rsyslog" | grep -v "grep"`

## 查看服务是否设置开机自启动

`systemctl  list-unit-files rsyslog.service`
